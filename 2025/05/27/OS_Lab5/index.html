<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>OS-Lab5 | å°ç†ŠçŒ«ä¸ºäº†æ˜¥æ—¥åŠå²›å†™ä»£ç </title><meta name="author" content="Nice2cu"><meta name="copyright" content="Nice2cu"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="#OS-Lab5 OS_Lab5æ„Ÿè§‰lab5ä¸»è¦å°±æ˜¯ä»‹ç»äº†ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œç”¨æ¥æŠ½è±¡åœ°ç®¡ç†ç£ç›˜ç­‰å¤–è®¾ã€‚ç›®å‰æ„Ÿè§‰æ¯”è¾ƒå›°éš¾çš„åœ°æ–¹åº”è¯¥æ˜¯å¾ˆå¤šç›¸ä¼¼åœ°å‡½æ•°è·¨è¶Šäº†å¤šä¸ªç³»ç»Ÿå±‚çº§ï¼Œä¸æ˜¯å¾ˆåˆ†å¾—æ¸…æ¥šï¼Œï¼Œï¼Œä½†æ˜¯æ˜¯æœ€åä¸€æ¬¡ä¸Šæœºäº†ï¼Œè¿˜æ˜¯æ€»ç»“ä¸€ä¸‹ğŸ˜‹ å®éªŒç›®çš„ï¼š  äº†è§£æ–‡ä»¶ç³»ç»Ÿçš„åŸºæœ¬æ¦‚å¿µå’Œä½œç”¨ã€‚ äº†è§£æ™®é€šç£ç›˜çš„åŸºæœ¬ç»“æ„å’Œè¯»å†™æ–¹å¼ã€‚ äº†è§£å®ç°è®¾å¤‡é©±åŠ¨çš„æ–¹æ³•ã€‚ æŒæ¡å¹¶å®ç°æ–‡ä»¶ç³»ç»ŸæœåŠ¡çš„åŸºæœ¬æ“ä½œã€‚ äº†è§£å¾®å†…æ ¸çš„åŸºæœ¬è®¾è®¡æ€æƒ³å’Œç»“æ„ã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="OS-Lab5">
<meta property="og:url" content="http://nice2cu22.github.io/2025/05/27/OS_Lab5/index.html">
<meta property="og:site_name" content="å°ç†ŠçŒ«ä¸ºäº†æ˜¥æ—¥åŠå²›å†™ä»£ç ">
<meta property="og:description" content="#OS-Lab5 OS_Lab5æ„Ÿè§‰lab5ä¸»è¦å°±æ˜¯ä»‹ç»äº†ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œç”¨æ¥æŠ½è±¡åœ°ç®¡ç†ç£ç›˜ç­‰å¤–è®¾ã€‚ç›®å‰æ„Ÿè§‰æ¯”è¾ƒå›°éš¾çš„åœ°æ–¹åº”è¯¥æ˜¯å¾ˆå¤šç›¸ä¼¼åœ°å‡½æ•°è·¨è¶Šäº†å¤šä¸ªç³»ç»Ÿå±‚çº§ï¼Œä¸æ˜¯å¾ˆåˆ†å¾—æ¸…æ¥šï¼Œï¼Œï¼Œä½†æ˜¯æ˜¯æœ€åä¸€æ¬¡ä¸Šæœºäº†ï¼Œè¿˜æ˜¯æ€»ç»“ä¸€ä¸‹ğŸ˜‹ å®éªŒç›®çš„ï¼š  äº†è§£æ–‡ä»¶ç³»ç»Ÿçš„åŸºæœ¬æ¦‚å¿µå’Œä½œç”¨ã€‚ äº†è§£æ™®é€šç£ç›˜çš„åŸºæœ¬ç»“æ„å’Œè¯»å†™æ–¹å¼ã€‚ äº†è§£å®ç°è®¾å¤‡é©±åŠ¨çš„æ–¹æ³•ã€‚ æŒæ¡å¹¶å®ç°æ–‡ä»¶ç³»ç»ŸæœåŠ¡çš„åŸºæœ¬æ“ä½œã€‚ äº†è§£å¾®å†…æ ¸çš„åŸºæœ¬è®¾è®¡æ€æƒ³å’Œç»“æ„ã€‚">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://nice2cu22.github.io/img/top-default.jpg">
<meta property="article:published_time" content="2025-05-27T15:01:31.000Z">
<meta property="article:modified_time" content="2025-05-27T15:01:39.979Z">
<meta property="article:author" content="Nice2cu">
<meta property="article:tag" content="BUAA_OS">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://nice2cu22.github.io/img/top-default.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "OS-Lab5",
  "url": "http://nice2cu22.github.io/2025/05/27/OS_Lab5/",
  "image": "http://nice2cu22.github.io/img/top-default.jpg",
  "datePublished": "2025-05-27T15:01:31.000Z",
  "dateModified": "2025-05-27T15:01:39.979Z",
  "author": [
    {
      "@type": "Person",
      "name": "Nice2cu",
      "url": "http://nice2cu22.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://nice2cu22.github.io/2025/05/27/OS_Lab5/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'OS-Lab5',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image: url(/img/background.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/my-avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">6</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">1</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> ä¸»é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-book-open"></i><span> ä½™å…‰è®°</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-leaf"></i><span> å’’è¯­å›¾é‰´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> è¯è¯­ç›’</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-address-book"></i><span> å‹äººå¸</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/top-default.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">å°ç†ŠçŒ«ä¸ºäº†æ˜¥æ—¥åŠå²›å†™ä»£ç </span></a><a class="nav-page-title" href="/"><span class="site-name">OS-Lab5</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> ä¸»é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-book-open"></i><span> ä½™å…‰è®°</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-leaf"></i><span> å’’è¯­å›¾é‰´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> è¯è¯­ç›’</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-address-book"></i><span> å‹äººå¸</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">OS-Lab5</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2025-05-27T15:01:31.000Z" title="Created 2025-05-27 23:01:31">2025-05-27</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-05-27T15:01:39.979Z" title="Updated 2025-05-27 23:01:39">2025-05-27</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><p>#OS-Lab5</p>
<h1 id="OS-Lab5"><a href="#OS-Lab5" class="headerlink" title="OS_Lab5"></a>OS_Lab5</h1><p>æ„Ÿè§‰lab5ä¸»è¦å°±æ˜¯ä»‹ç»äº†ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œç”¨æ¥æŠ½è±¡åœ°ç®¡ç†ç£ç›˜ç­‰å¤–è®¾ã€‚ç›®å‰æ„Ÿè§‰æ¯”è¾ƒå›°éš¾çš„åœ°æ–¹åº”è¯¥æ˜¯å¾ˆå¤šç›¸ä¼¼åœ°å‡½æ•°è·¨è¶Šäº†å¤šä¸ªç³»ç»Ÿå±‚çº§ï¼Œä¸æ˜¯å¾ˆåˆ†å¾—æ¸…æ¥šï¼Œï¼Œï¼Œä½†æ˜¯æ˜¯æœ€åä¸€æ¬¡ä¸Šæœºäº†ï¼Œè¿˜æ˜¯æ€»ç»“ä¸€ä¸‹ğŸ˜‹</p>
<p>å®éªŒç›®çš„ï¼š</p>
<ol>
<li>äº†è§£æ–‡ä»¶ç³»ç»Ÿçš„åŸºæœ¬æ¦‚å¿µå’Œä½œç”¨ã€‚</li>
<li>äº†è§£æ™®é€šç£ç›˜çš„åŸºæœ¬ç»“æ„å’Œè¯»å†™æ–¹å¼ã€‚</li>
<li>äº†è§£å®ç°è®¾å¤‡é©±åŠ¨çš„æ–¹æ³•ã€‚</li>
<li>æŒæ¡å¹¶å®ç°æ–‡ä»¶ç³»ç»ŸæœåŠ¡çš„åŸºæœ¬æ“ä½œã€‚</li>
<li>äº†è§£å¾®å†…æ ¸çš„åŸºæœ¬è®¾è®¡æ€æƒ³å’Œç»“æ„ã€‚</li>
</ol>
<h3 id="1-æ–‡ä»¶ç³»ç»Ÿæ¦‚è¿°"><a href="#1-æ–‡ä»¶ç³»ç»Ÿæ¦‚è¿°" class="headerlink" title="1.æ–‡ä»¶ç³»ç»Ÿæ¦‚è¿°"></a>1.æ–‡ä»¶ç³»ç»Ÿæ¦‚è¿°</h3><h4 id="1-1æ–‡ä»¶ç³»ç»Ÿçš„è®¾è®¡ä¸å®ç°"><a href="#1-1æ–‡ä»¶ç³»ç»Ÿçš„è®¾è®¡ä¸å®ç°" class="headerlink" title="1.1æ–‡ä»¶ç³»ç»Ÿçš„è®¾è®¡ä¸å®ç°"></a>1.1æ–‡ä»¶ç³»ç»Ÿçš„è®¾è®¡ä¸å®ç°</h4><blockquote>
<p><strong>ğŸ“•æ–‡ä»¶ç³»ç»Ÿ</strong>ï¼šï¼ˆä¸ºäº†ä¾¿äºç®¡ç†å’Œè®¿é—®å­˜æ”¾åœ¨å¤–éƒ¨å­˜å‚¨è®¾å¤‡ä¸Šçš„æ•°æ®ï¼‰åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œæ–‡ä»¶æ˜¯æ•°æ®å­˜å‚¨å’Œè®¿é—®çš„åŸºæœ¬å•ä½ã€‚</p>
</blockquote>
<ul>
<li><strong>å¤–éƒ¨å­˜å‚¨è®¾å¤‡é©±åŠ¨</strong>ï¼šé€šè¿‡<strong>ç³»ç»Ÿè°ƒç”¨</strong>çš„æ–¹å¼é™·å…¥å†…æ ¸ï¼Œå¯¹ç£ç›˜é•œåƒè¿›è¡Œè¯»å†™æ“ä½œã€‚</li>
<li><strong>æ–‡ä»¶ç³»ç»Ÿç»“æ„</strong>ï¼š<code>fs</code> ç›®å½•ä¸‹å­˜æ”¾çš„æ˜¯æ–‡ä»¶ç³»ç»ŸæœåŠ¡ç¨‹åºçš„ä»£ç ï¼›è€Œ <code>user/lib</code> ç›®å½•ä¸­çš„ <code>file.c</code>ã€<code>fd.c</code>ã€<code>fsipc.c</code> ç­‰æ–‡ä»¶åˆ™å­˜æ”¾äº†æ–‡ä»¶ç³»ç»Ÿçš„ç”¨æˆ·åº“ã€‚æ–‡ä»¶ç³»ç»ŸæœåŠ¡è¿›ç¨‹å’Œå…¶ä»–ç”¨æˆ·è¿›ç¨‹ä¹‹é—´ä½¿ç”¨ <strong>IPCæœºåˆ¶</strong>è¿›è¡Œé€šä¿¡</li>
<li><strong>æ–‡ä»¶ç³»ç»Ÿçš„ç”¨æˆ·æ¥å£</strong>ï¼šé€šè¿‡ä¸€ä¸ªç”¨æˆ·æ€çš„æ–‡ä»¶ç³»ç»ŸæœåŠ¡æ¥å®ç°</li>
</ul>
<blockquote>
<p><strong>æ•´ä½“ä»£ç æ¡†æ¶ï¼š</strong></p>
</blockquote>
<ul>
<li><strong>tools</strong> ç›®å½•ä¸­å­˜æ”¾çš„æ˜¯æ„å»ºæ—¶è¾…åŠ©å·¥å…·çš„ä»£ç ã€‚æˆ‘ä»¬å°†åœ¨å…¶ä¸­å®ç° fsformat å·¥å…·ï¼Œå¹¶å€ŸåŠ©å®ƒæ¥åˆ›å»ºç£ç›˜é•œåƒã€‚</li>
<li><strong>fs</strong> ç›®å½•ä¸­å­˜æ”¾çš„æ˜¯æ–‡ä»¶ç³»ç»ŸæœåŠ¡è¿›ç¨‹çš„ä»£ç ã€‚<code>fs.c</code> ä¸­å®ç°æ–‡ä»¶ç³»ç»Ÿçš„åŸºæœ¬åŠŸèƒ½å‡½æ•°ï¼Œ<code>ide.c</code> ä¸­é€šè¿‡ç³»ç»Ÿè°ƒç”¨ä¸ç£ç›˜é•œåƒè¿›è¡Œäº¤äº’ï¼Œä¸»å¹²å‡½æ•°åœ¨ <code>serv.c</code> ä¸­ã€‚é€šè¿‡ <strong>IPC é€šä¿¡</strong>ä¸ç”¨æˆ·è¿›ç¨‹ <code>user/lib/fsipc.c</code> å†…çš„é€šä¿¡å‡½æ•°è¿›è¡Œäº¤äº’ã€‚</li>
<li><strong>user&#x2F;lib</strong> ç›®å½•ä¸‹å­˜æ”¾äº†ç”¨æˆ·ç¨‹åºçš„åº“å‡½æ•°ã€‚<code>fsipc.c</code> å®ç°äº†ä¸æ–‡ä»¶ç³»ç»ŸæœåŠ¡è¿›ç¨‹çš„äº¤äº’ï¼Œ<code>file.c</code> å®ç°äº†æ–‡ä»¶ç³»ç»Ÿçš„ç”¨æˆ·æ¥å£ï¼Œ<code>fd.c</code> ä¸­å®ç°äº†æ–‡ä»¶æè¿°ç¬¦ã€‚</li>
</ul>
<blockquote>
<p>åŒºåˆ†ä¸€ä¸ªå¾ˆæ··æ·†çš„æ¦‚å¿µï¼š</p>
</blockquote>
<p><strong><code>dev_\*</code> æ˜¯é€šç”¨è®¾å¤‡æ¥å£</strong>ï¼Œä»£è¡¨â€œæˆ‘ä¸å…³å¿ƒä½ æ˜¯å“ªç§è®¾å¤‡â€ï¼›<br><strong><code>ide_\*</code> æ˜¯å…·ä½“çš„ç£ç›˜ï¼ˆIDE ç¡¬ç›˜ï¼‰é©±åŠ¨å‡½æ•°</strong>ï¼Œä¸“é—¨å¤„ç†ç£ç›˜æ“ä½œã€‚</p>
<p>&#x2F;&#x2F;æˆ‘è§‰å¾—ä¸æ˜¯æˆ‘çš„é—®é¢˜ï¼Œä¸ºä»€ä¹ˆæŒ‡å¯¼ä¹¦å°±ä¸èƒ½æŠŠè¿™ä¸ªå†™å‡ºæ¥å‘¢ï¼Ÿå†™å¾—å…¨æ˜¯è‹±æ–‡çš„ç¼©å†™æ–¹æ³•ï¼Œæœ¬æ¥å°±éš¾ä»¥ç†è§£ä»–ä»¬çš„åŠŸèƒ½ï¼Œéš¾é“åç§°ä¸åº”è¯¥è¦è®©äººæ˜“æ‡‚ä¸€ç‚¹å—ï¼Ÿç®—äº†ä¸éª‚äº†ã€‚</p>
<h3 id="2-ç£ç›˜é©±åŠ¨"><a href="#2-ç£ç›˜é©±åŠ¨" class="headerlink" title="2.ç£ç›˜é©±åŠ¨"></a>2.ç£ç›˜é©±åŠ¨</h3><h4 id="2-1-å†…å­˜æ˜ å°„"><a href="#2-1-å†…å­˜æ˜ å°„" class="headerlink" title="2.1 å†…å­˜æ˜ å°„"></a>2.1 å†…å­˜æ˜ å°„</h4><p>æŠŠæŒ‡å¯¼ä¹¦é‡Œçš„å†…å®¹è½¬æˆä¸€ç³»åˆ—äººè¯ï¼š</p>
<h5 id="1-â€œè®¾å¤‡æ˜¯æ€ä¹ˆå’Œ-CPU-é€šä¿¡çš„ï¼Ÿâ€"><a href="#1-â€œè®¾å¤‡æ˜¯æ€ä¹ˆå’Œ-CPU-é€šä¿¡çš„ï¼Ÿâ€" class="headerlink" title="1. â€œè®¾å¤‡æ˜¯æ€ä¹ˆå’Œ CPU é€šä¿¡çš„ï¼Ÿâ€"></a>1. â€œè®¾å¤‡æ˜¯æ€ä¹ˆå’Œ CPU é€šä¿¡çš„ï¼Ÿâ€</h5><blockquote>
<p>â€œæ¯ä¸€ç§å¤–è®¾éƒ½æ˜¯é€šè¿‡è¯»å†™è®¾å¤‡ä¸Šçš„å¯„å­˜å™¨æ¥è¿›è¡Œæ•°æ®é€šä¿¡â€</p>
</blockquote>
<h5 id="2-â€œå¤–è®¾å¯„å­˜å™¨æ˜¯æ€ä¹ˆæ‰¾åˆ°çš„ï¼Ÿâ€"><a href="#2-â€œå¤–è®¾å¯„å­˜å™¨æ˜¯æ€ä¹ˆæ‰¾åˆ°çš„ï¼Ÿâ€" class="headerlink" title="2. â€œå¤–è®¾å¯„å­˜å™¨æ˜¯æ€ä¹ˆæ‰¾åˆ°çš„ï¼Ÿâ€"></a>2. â€œå¤–è®¾å¯„å­˜å™¨æ˜¯æ€ä¹ˆæ‰¾åˆ°çš„ï¼Ÿâ€</h5><blockquote>
<p>â€œè¿™äº›å¯„å­˜å™¨è¢«æ˜ å°„åˆ°æŒ‡å®šçš„ç‰©ç†åœ°å€ç©ºé—´â€</p>
</blockquote>
<ul>
<li>æ¯ä¸ªè®¾å¤‡åœ¨å†…å­˜é‡Œæœ‰ä¸€ä¸ªâ€œå›ºå®šçš„åœ°å€èŒƒå›´â€ï¼Œå«<strong>å†…å­˜æ˜ å°„ I&#x2F;O</strong>ã€‚<ul>
<li>æ¯”å¦‚ï¼šä¸²å£ console åœ¨ <code>0x180003F8</code>ï¼ŒIDE æ§åˆ¶å™¨åœ¨ <code>0x180001F0</code></li>
</ul>
</li>
<li><strong>ä½ åªè¦å¯¹è¿™ä¸ªåœ°å€è¯»å†™ï¼Œç›¸å½“äºåœ¨æ“ä½œè¿™ä¸ªè®¾å¤‡ï¼</strong></li>
</ul>
<h5 id="3-â€œMIPS-æ¶æ„ç”¨å“ªå—åœ°å€ç©ºé—´æ¥è®¿é—®è®¾å¤‡ï¼Ÿâ€"><a href="#3-â€œMIPS-æ¶æ„ç”¨å“ªå—åœ°å€ç©ºé—´æ¥è®¿é—®è®¾å¤‡ï¼Ÿâ€" class="headerlink" title="3. â€œMIPS æ¶æ„ç”¨å“ªå—åœ°å€ç©ºé—´æ¥è®¿é—®è®¾å¤‡ï¼Ÿâ€"></a>3. â€œMIPS æ¶æ„ç”¨å“ªå—åœ°å€ç©ºé—´æ¥è®¿é—®è®¾å¤‡ï¼Ÿâ€</h5><blockquote>
<p>â€œä½¿ç”¨ kseg1 æ®µâ€¦ ä¸ç»è¿‡ MMUï¼Œä¹Ÿä¸ç”¨ç¼“å­˜â€</p>
</blockquote>
<p>ç„¶åæŒ‡å¯¼ä¹¦ä¸¾äº†ä¸€ä¸ªå¾ˆä¸‘çš„ä¸²å£é©±åŠ¨çš„ä¾‹å­ï¼Œå¤§æ¦‚æ˜¯ä¸ºäº†å¼•å‡ºç£ç›˜é©±åŠ¨å§ï¼Œä½†æ˜¯çœŸçš„å¾ˆä¸‘ã€‚æ„æ€å°±æ˜¯ï¼š</p>
<p> <strong>æ ¸å¿ƒä¸åŒåœ¨äº â€”â€” ä¸²å£é©±åŠ¨å†™åœ¨å†…æ ¸é‡Œï¼Œè€Œç£ç›˜é©±åŠ¨å†™åœ¨â€œç”¨æˆ·æ€â€ï¼</strong>æ‰€ä»¥å¯¹äºè®¾å¤‡çš„è¯»å†™å¿…é¡»é€šè¿‡<strong>ç³»ç»Ÿè°ƒç”¨</strong>æ¥å®ç°ï¼ˆ<code>sys_write_dev</code> å’Œ <code>sys_read_dev</code>ï¼‰ã€‚</p>
<p><strong>Exercise 5.1</strong> å®Œæˆ sys_write_dev å‡½æ•°ä»¥åŠsys_read_dev å‡½æ•°çš„å®ç°ã€‚</p>
<p><code>sys_write_dev(u_int va, u_int pa, u_int len)</code>ï¼š<strong>ä»ç”¨æˆ·ç©ºé—´ï¼ˆvaï¼‰æ‹¿ä¸€æ®µæ•°æ®ï¼Œå†™å…¥åˆ°è®¾å¤‡çš„ç‰©ç†åœ°å€ï¼ˆpaï¼‰é‡Œ</strong>ã€‚</p>
<p><code>sys_read_dev(u_int va, u_int pa, u_int len)</code>ï¼š<strong>ä»è®¾å¤‡çš„ç‰©ç†åœ°å€ï¼ˆpaï¼‰æ‹¿ä¸€æ®µæ•°æ®ï¼Œå†™å…¥åˆ°ç”¨æˆ·ç©ºé—´ï¼ˆvaï¼‰é‡Œ</strong>ã€‚</p>
<p><strong>Exercise 5.2</strong> åœ¨ user&#x2F;lib&#x2F;syscall_lib.c ä¸­å®Œæˆç”¨æˆ·æ€çš„ç›¸åº”ç³»ç»Ÿè°ƒç”¨çš„æ¥å£ã€‚</p>
<h4 id="2-2-IDEç£ç›˜"><a href="#2-2-IDEç£ç›˜" class="headerlink" title="2.2 IDEç£ç›˜"></a>2.2 IDEç£ç›˜</h4><p>è¿™æ®µè¯å°±è®²äº†ï¼š</p>
<blockquote>
<p>ç£ç›˜æœ‰ä¸¤ç§å¯»å€æ–¹æ³•ï¼ŒCHS(æŸ±é¢-ç£å¤´-æ‰‡åŒº) æ˜¯ç‰©ç†ç»“æ„çš„è€æ–¹æ³•ï¼Œå¤æ‚ä¸”ä¸ä¾¿ç”¨ï¼›LBA æ˜¯çº¿æ€§ç¼–å·æ–¹å¼ï¼Œç®€å•æ–¹ä¾¿ï¼Œå®éªŒé‡Œæˆ‘ä»¬å°±ç”¨è¿™ä¸ªï¼Œæœ€å¤šèƒ½è®¿é—®128GBï¼Œç³»ç»Ÿé€šè¿‡ä¸€ç»„å¯„å­˜å™¨å‘Šè¯‰è®¾å¤‡å“ªä¸ªæ‰‡åŒºè¦æ“ä½œã€‚</p>
</blockquote>
<p>åœ¨æˆ‘ä»¬çš„å®éªŒä¸­ï¼Œæ‰‡åŒºç¼–å·æœ‰ 28 ä½ï¼Œå› æ­¤æœ€å¤šå¯ä»¥å¯»å€ 2^28 ä¸ªæ‰‡åŒºï¼Œå³ 128 GB çš„ç£ç›˜ç©ºé—´ã€‚</p>
<h4 id="2-3-é©±åŠ¨ç¨‹åºç¼–å†™"><a href="#2-3-é©±åŠ¨ç¨‹åºç¼–å†™" class="headerlink" title="2.3 é©±åŠ¨ç¨‹åºç¼–å†™"></a>2.3 é©±åŠ¨ç¨‹åºç¼–å†™</h4><p>è¿™æ®µè¯å°±è®²äº†ï¼š</p>
<blockquote>
<p>è¯»å†™ç£ç›˜å°±æ˜¯è¯»å†™è®¾å¤‡å¯„å­˜å™¨å’Œæ•°æ®ç¼“å†²åŒºï¼Œæ“ä½œå‰å¾—ç¡®ä¿è®¾å¤‡ä¸å¿™</p>
<p><code>wait_ide</code> å‡½æ•°å°±æ˜¯å¸®ä½ è½®è¯¢æ£€æŸ¥è®¾å¤‡å¿™é—²çŠ¶æ€</p>
<p>ç‰©ç†åœ°å€è½¬æ¢æˆå†…æ ¸è™šæ‹Ÿåœ°å€æ˜¯å¿…è¦çš„ï¼Œå¦åˆ™æ²¡æ³•æ“ä½œå¯„å­˜å™¨</p>
<p>è¿™äº›æ­¥éª¤ä¸²èµ·æ¥ï¼Œå°±èƒ½å®‰å…¨ã€æ­£ç¡®åœ°è¯»å†™ç£ç›˜ä¸€ä¸ªæ‰‡åŒº</p>
</blockquote>
<p>ç„¶åä»–ä¸¾äº†ä¸€ä¸ªè®©äººè¿·æƒ‘çš„<code>read_sector</code>å’Œ<code>write_sector</code>å‡½æ•°ï¼Œç„¶ååˆè®©æˆ‘ä»¬è‡ªå·±å†™<code>ide_read</code>å’Œ<code>ide_write</code>å‡½æ•°ã€‚è¿™ä¸¤å‡½æ•°åŠŸèƒ½éš¾é“ä¸ä¸€æ ·ï¼Ÿä½ æƒ³åšä»€ä¹ˆï¼Ÿ</p>
<p>åé¢æ‰å‘ç°ï¼Œè¿™ä¸¤ä¸ªå‡½æ•° <code>read_sector</code> å’Œ <code>ide_read</code> åšçš„æ˜¯<strong>ç±»ä¼¼çš„äº‹ï¼šä» IDE ç£ç›˜ä¸­è¯»å–æ‰‡åŒºæ•°æ®</strong>ã€‚</p>
<p><code>read_sector</code> æ˜¯â€œ<strong>å†…æ ¸ç»™å†…æ ¸è‡ªå·±ç”¨</strong>çš„â€ï¼Œèƒ½ç›´æ¥è®¿é—®è®¾å¤‡åœ°å€ï¼›</p>
<p><code>ide_read</code> æ˜¯â€œ<strong>ç”¨æˆ·ç¨‹åºç”¨çš„æ¥å£</strong>â€ï¼Œå¿…é¡»é€šè¿‡ç³»ç»Ÿè°ƒç”¨å’Œå†…æ ¸äº¤äº’æ‰èƒ½è¯»ç£ç›˜ã€‚</p>
<p>å¥½äº†ï¼Œé‚£<strong>Exercise 5.3</strong>å°±æ˜¯è¡¥å…¨è¿™ä¸ª<code>ide_read</code>å’Œ<code>ide_write</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//disknoï¼šè¯»å“ªå—ç£ç›˜ secno:ä»å“ªä¸ªæ‰‡åŒºå¼€å§‹ dst:è¯»å–çš„æ•°æ®å­˜æ”¾çš„ä½ç½® nsecs:è¦è¯»å‡ ä¸ªæ‰‡åŒº</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">ide_read</span><span class="params">(u_int diskno, u_int secno, <span class="type">void</span> *dst, u_int nsecs)</span> &#123;</span><br><span class="line">	<span class="type">uint8_t</span> temp;</span><br><span class="line">	u_int offset = <span class="number">0</span>, max = nsecs + secno;</span><br><span class="line">	panic_on(diskno &gt;= <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> (secno &lt; max) &#123;</span><br><span class="line">		temp = wait_ide_ready();</span><br><span class="line">		<span class="comment">// å†™è¯»ä¸€ä¸ªæ‰‡åŒº</span></span><br><span class="line">		temp = <span class="number">1</span>;</span><br><span class="line">		panic_on(syscall_write_dev(&amp;temp, MALTA_IDE_NSECT, <span class="number">1</span>));</span><br><span class="line">		<span class="comment">// å†™æ‰‡åŒºç¼–å·ä½8ä½</span></span><br><span class="line">		temp = secno &amp; <span class="number">0xff</span>;</span><br><span class="line">		panic_on(syscall_write_dev(&amp;temp, MALTA_IDE_LBAL, <span class="number">1</span>));</span><br><span class="line">		<span class="comment">// å†™ä¸­é—´8ä½</span></span><br><span class="line">		temp = (secno &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xff</span>;</span><br><span class="line">		panic_on(syscall_write_dev(&amp;temp, MALTA_IDE_LBAM, <span class="number">1</span>));</span><br><span class="line">		<span class="comment">// å†™é«˜8ä½</span></span><br><span class="line">		temp = (secno &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xff</span>;</span><br><span class="line">		panic_on(syscall_write_dev(&amp;temp, MALTA_IDE_LBAH, <span class="number">1</span>));</span><br><span class="line">        <span class="comment">// å†™æœ€å4ä½+æ¨¡å¼+ç›˜å·</span></span><br><span class="line">		temp = ((secno &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0x0f</span>) | MALTA_IDE_LBA | (diskno &lt;&lt; <span class="number">4</span>);</span><br><span class="line">		panic_on(syscall_write_dev(&amp;temp, MALTA_IDE_DEVICE, <span class="number">1</span>));</span><br><span class="line">		<span class="comment">// å†™â€œå¼€å§‹è¯»â€çš„çŠ¶æ€</span></span><br><span class="line">		temp = MALTA_IDE_CMD_PIO_READ;</span><br><span class="line">		panic_on(syscall_write_dev(&amp;temp, MALTA_IDE_STATUS, <span class="number">1</span>));</span><br><span class="line">		<span class="comment">// ç­‰å¾…å‡†å¤‡</span></span><br><span class="line">		temp = wait_ide_ready();</span><br><span class="line">		<span class="comment">// å¼€å§‹è¯»</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; SECT_SIZE / <span class="number">4</span>; i++) &#123;</span><br><span class="line">			panic_on(syscall_read_dev(dst + offset + i * <span class="number">4</span>, MALTA_IDE_DATA, <span class="number">4</span>));</span><br><span class="line">		&#125;</span><br><span class="line">		panic_on(syscall_read_dev(&amp;temp, MALTA_IDE_STATUS, <span class="number">1</span>));</span><br><span class="line">		offset += SECT_SIZE;</span><br><span class="line">		secno += <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¡¥å……ä¸€ä¸ªå®å®šä¹‰å§ï¼Œæ„Ÿè§‰è¿™ä¸ªæ›´åŠ ä¾¿äºç†è§£ã€‚</p>
<table>
<thead>
<tr>
<th>ä½æ•°èŒƒå›´</th>
<th>å¯¹åº”å¯„å­˜å™¨</th>
<th>ç¤ºä¾‹ä»£ç </th>
</tr>
</thead>
<tbody><tr>
<td>secno[7:0]</td>
<td>LBAL</td>
<td><code>temp = secno &amp; 0xff;</code></td>
</tr>
<tr>
<td>secno[15:8]</td>
<td>LBAM</td>
<td><code>temp = (secno &gt;&gt; 8) &amp; 0xff;</code></td>
</tr>
<tr>
<td>secno[23:16]</td>
<td>LBAH</td>
<td><code>temp = (secno &gt;&gt; 16) &amp; 0xff;</code></td>
</tr>
<tr>
<td>secno[27:24]</td>
<td>DEVICE</td>
<td><code>temp = ((secno &gt;&gt; 24) &amp; 0x0f)</code></td>
</tr>
</tbody></table>
<p>å®ç°äº†ç£ç›˜é©±åŠ¨ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•å¯¹ç£ç›˜è¿›è¡Œè¯»å†™ã€‚<strong>ç¬¬ä¸€éƒ¨åˆ†åˆ°è¿™å°±ç»“æŸå•¦ï¼</strong></p>
<p>ä¸»è¦æ˜¯å®ç°äº†ä¸¤ç±»å‡½æ•°ï¼š<code>sys_write_dev</code> &amp; <code>sys_read_dev</code>å’Œ<code>ide_read</code>&amp;<code>ide_write</code></p>
<p>ä¸»è¦æ˜¯åœ¨ç”¨æˆ·æ€<code>ide_read</code>é‡Œç³»ç»Ÿè°ƒç”¨<code>syscall_read_dev</code>ï¼Œç„¶åå†åœ¨<code>sys_read_dev</code>ä¸­æ‰§è¡Œã€‚</p>
<h3 id="3-æ–‡ä»¶ç³»ç»Ÿç»“æ„"><a href="#3-æ–‡ä»¶ç³»ç»Ÿç»“æ„" class="headerlink" title="3.æ–‡ä»¶ç³»ç»Ÿç»“æ„"></a>3.æ–‡ä»¶ç³»ç»Ÿç»“æ„</h3><h4 id="3-1ç£ç›˜æ–‡ä»¶ç³»ç»Ÿå¸ƒå±€"><a href="#3-1ç£ç›˜æ–‡ä»¶ç³»ç»Ÿå¸ƒå±€" class="headerlink" title="3.1ç£ç›˜æ–‡ä»¶ç³»ç»Ÿå¸ƒå±€"></a>3.1ç£ç›˜æ–‡ä»¶ç³»ç»Ÿå¸ƒå±€</h4><p>è¿™æ®µè¯å…ˆè®²äº†ç£ç›˜å—æ˜¯ä»€ä¹ˆï¼š</p>
<blockquote>
<p>æ“ä½œç³»ç»Ÿä¸ç›´æ¥æŒ‰æ‰‡åŒºç®¡ç†ç£ç›˜ï¼Œè€Œæ˜¯æŠŠå¤šä¸ªæ‰‡åŒºç»„æˆä¸€ä¸ªç£ç›˜å—ï¼Œç®€åŒ–æ“ä½œã€‚</p>
<p>æœ€å¼€å§‹çš„ä¸€ä¸ªç£ç›˜å—ï¼ˆ4096 å­—èŠ‚ï¼‰å½“ä½œ<strong>å¼•å¯¼æ‰‡åŒºå’Œåˆ†åŒºè¡¨</strong>ä½¿ç”¨ã€‚æ¥ä¸‹æ¥çš„ä¸€ä¸ªç£ç›˜å—ä½œä¸º<strong>è¶…çº§å—</strong></p>
<p>è¶…çº§å—å­˜äº†æ–‡ä»¶ç³»ç»Ÿçš„å…³é”®ä¿¡æ¯ï¼Œç³»ç»Ÿå¯åŠ¨æ—¶ä¼šç”¨åˆ°ã€‚</p>
<p>æ–‡ä»¶ç³»ç»Ÿç”¨ä½å›¾æ¥ç®¡ç†ç£ç›˜ç©ºé—´çš„ä½¿ç”¨æƒ…å†µã€‚</p>
</blockquote>
<p>ç„¶åå¼•å…¥<code>fsforma.c</code>è¿™ä¸ªæ–‡ä»¶ï¼š</p>
<blockquote>
<p><code>fsformat.c</code> æ˜¯â€œåˆå§‹åŒ–é˜¶æ®µâ€çš„æ„å»ºå·¥å…·ï¼Œ<br> <code>fs.c</code> æ˜¯â€œè¿è¡Œæ—¶é˜¶æ®µâ€çš„æ ¸å¿ƒæ–‡ä»¶ç³»ç»Ÿé€»è¾‘ã€‚</p>
</blockquote>
<p><strong>Exercise 5.4</strong> å®Œæˆ fs&#x2F;fs.c ä¸­çš„ free_block å‡½æ•°</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">free_block</span><span class="params">(u_int blockno)</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> (blockno == <span class="number">0</span> || blockno &gt;= super-&gt;s_nblocks) &#123;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//è¿™ä¸€æ­¥æˆ‘è¿˜ä¸çŸ¥é“ä¸ºå•¥ï¼Œä½†æˆ‘ä¹Ÿä¸æ˜¯å¾ˆæƒ³çœ‹ã€‚ã€‚ä¹‹åå†è¯´å§</span></span><br><span class="line">	bitmap[blockno / <span class="number">32</span>] |= <span class="number">1</span> &lt;&lt; (blockno &amp; <span class="number">0x1f</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-æ–‡ä»¶ç³»ç»Ÿè¯¦ç»†ç»“æ„"><a href="#3-2-æ–‡ä»¶ç³»ç»Ÿè¯¦ç»†ç»“æ„" class="headerlink" title="3.2 æ–‡ä»¶ç³»ç»Ÿè¯¦ç»†ç»“æ„"></a>3.2 æ–‡ä»¶ç³»ç»Ÿè¯¦ç»†ç»“æ„</h4><p>åˆå¼€å§‹è¯´äººè¯ï¼ˆå…¶å®æ¯æ¬¡å†™è¿™ä¸ªéƒ½å¾ˆæƒ³éª‚äººï¼Œä¸ºä»€ä¹ˆæŒ‡å¯¼ä¹¦ä¸èƒ½è¯´äººè¯â”‘(ï¿£Ğ” ï¿£)â”ï¼‰ï¼š</p>
<h5 id="ğŸ§±-ä¸€ã€ä»€ä¹ˆæ˜¯æ–‡ä»¶æ§åˆ¶å—ï¼ˆstruct-Fileï¼‰ï¼Ÿ"><a href="#ğŸ§±-ä¸€ã€ä»€ä¹ˆæ˜¯æ–‡ä»¶æ§åˆ¶å—ï¼ˆstruct-Fileï¼‰ï¼Ÿ" class="headerlink" title="ğŸ§± ä¸€ã€ä»€ä¹ˆæ˜¯æ–‡ä»¶æ§åˆ¶å—ï¼ˆstruct Fileï¼‰ï¼Ÿ"></a>ğŸ§± ä¸€ã€ä»€ä¹ˆæ˜¯æ–‡ä»¶æ§åˆ¶å—ï¼ˆ<code>struct File</code>ï¼‰ï¼Ÿ</h5><p>å®ƒæ˜¯æ“ä½œç³»ç»Ÿç”¨æ¥<strong>æè¿°å’Œç®¡ç†æ–‡ä»¶çš„å…³é”®æ•°æ®ç»“æ„</strong>ï¼Œæ¯ä¸ªæ–‡ä»¶æˆ–ç›®å½•éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„ <code>File</code> ç»“æ„ä½“ï¼š</p>
<ul>
<li><code>f_name</code>ï¼šæ–‡ä»¶åï¼ˆæœ€å¤š 128 å­—èŠ‚ï¼‰</li>
<li><code>f_size</code>ï¼šæ–‡ä»¶å¤§å°ï¼ˆå•ä½æ˜¯å­—èŠ‚ï¼‰</li>
<li><code>f_type</code>ï¼šæ–‡ä»¶ç±»å‹ï¼ˆæ™®é€šæ–‡ä»¶ or ç›®å½•ï¼‰</li>
<li><code>f_direct[10]</code>ï¼š10 ä¸ªç›´æ¥æŒ‡é’ˆï¼Œ<strong>æŒ‡å‘ç£ç›˜ä¸Šçš„æ•°æ®å—</strong></li>
<li><code>f_indirect</code>ï¼š1 ä¸ªé—´æ¥æŒ‡é’ˆï¼Œ<strong>æŒ‡å‘ç£ç›˜ä¸Šçš„æ•°æ®å—</strong></li>
<li><code>f_dir</code>ï¼šæŒ‡å‘æ‰€å±ç›®å½•ï¼ˆåªåœ¨å†…å­˜ä¸­æœ‰æ•ˆï¼‰</li>
<li><code>f_pad</code>ï¼šç»“æ„ä½“è¡¥é½å­—æ®µï¼Œä½¿å¤šä¸ª File æ°å¥½å¡«æ»¡ä¸€ä¸ªç£ç›˜å—</li>
</ul>
<p><strong>Exercise 5.5</strong> å®Œæˆ fsformat.c ä¸­çš„ create_file å‡½æ•°</p>
<blockquote>
<p>åœ¨ç»™å®šç›®å½• <code>dirf</code> ä¸­åˆ†é…ä¸€ä¸ªâ€œç©ºæ§½ä½â€ç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> File *<span class="title function_">create_file</span><span class="params">(<span class="keyword">struct</span> File *dirf)</span> &#123;</span><br><span class="line">	<span class="type">int</span> nblk = dirf-&gt;f_size / BLOCK_SIZE;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; nblk; ++i) &#123;</span><br><span class="line">		<span class="type">int</span> bno; </span><br><span class="line">		<span class="keyword">if</span> (i &lt; NDIRECT) &#123;</span><br><span class="line">			bno = dirf-&gt;f_direct[i];</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			bno = ((<span class="type">int</span> *)(disk[dirf-&gt;f_indirect].data))[i];</span><br><span class="line">		&#125;</span><br><span class="line">        <span class="comment">//è¿™ä¸ªç£ç›˜å—æ˜¯ç›®å½•æ–‡ä»¶ï¼ˆå› ä¸ºä¼ è¿›æ¥çš„ dirf æ˜¯ä¸€ä¸ªç›®å½•ç±»å‹çš„æ–‡ä»¶æ§åˆ¶å—ï¼‰ï¼Œå®ƒå­˜çš„æ˜¯ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶çš„æ–‡ä»¶æ§åˆ¶å—ï¼ˆFileï¼‰ã€‚</span></span><br><span class="line">        <span class="comment">//æ‰€ä»¥éœ€è¦æŠŠå®ƒå½“æˆ struct File[] æ•°ç»„æ¥éå†ï¼Œè€Œä¸æ˜¯å½“æ™®é€šå­—èŠ‚æ¥çœ‹ã€‚</span></span><br><span class="line">		<span class="class"><span class="keyword">struct</span> <span class="title">File</span> *<span class="title">blk</span> =</span> (<span class="keyword">struct</span> File *)(disk[bno].data);</span><br><span class="line">        </span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">struct</span> File *f = blk; f &lt; blk + FILE2BLK; ++f) &#123;</span><br><span class="line">			<span class="comment">//</span></span><br><span class="line">			<span class="keyword">if</span> (f-&gt;f_name[<span class="number">0</span>] == <span class="string">&#x27;\0&#x27;</span>) &#123;</span><br><span class="line">				<span class="keyword">return</span> f;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//å¦‚æœæ‰¾ä¸åˆ°ç©ºä½ç½®æ€ä¹ˆåŠï¼Ÿè°ƒç”¨ make_link_block(dirf, nblk) åˆ†é…ä¸€ä¸ªæ–°çš„å—ï¼ŒæŒ‚åˆ°ç›®å½• dirf ä¸Šå»ã€‚</span></span><br><span class="line">	<span class="type">int</span> bno = make_link_block(dirf, nblk);</span><br><span class="line">	<span class="keyword">return</span> (<span class="keyword">struct</span> File *)(disk[bno].data);</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-3-å—ç¼“å­˜"><a href="#3-3-å—ç¼“å­˜" class="headerlink" title="3.3 å—ç¼“å­˜"></a>3.3 å—ç¼“å­˜</h4><p>æ€»ç»“äººè¯ï¼š</p>
<blockquote>
<p>MOS æ“ä½œç³»ç»Ÿä¸ºäº†åŠ å¿«ç£ç›˜è®¿é—®ï¼Œåœ¨ç”¨æˆ·è¿›ç¨‹ä¸­åˆ’å‡ºä¸€æ®µè™šæ‹Ÿåœ°å€ç©ºé—´ï¼ˆä» <code>0x10000000</code> å¼€å§‹ï¼Œæ€»å…± 1GBï¼‰ï¼Œä½œä¸ºç£ç›˜å—çš„ç¼“å­˜åŒºï¼›ç£ç›˜å—è¯»å…¥å†…å­˜æ—¶å°±æ˜ å°„åˆ°è¿™æ®µç©ºé—´é‡Œï¼Œä»¥åè®¿é—®å°±å¯ä»¥ç›´æ¥ç”¨å†…å­˜è®¿é—®ï¼Œä¸ç”¨æ¯æ¬¡éƒ½å»æ…¢æ…¢è¯»ç£ç›˜ã€‚</p>
</blockquote>
<p>æ„Ÿè§‰å’Œtlbæœ‰ç‚¹ç±»ä¼¼ï¼šéƒ½æ˜¯ç¼“å­˜æœºåˆ¶ï¼Œéƒ½æ˜¯ç”¨â€œç©ºé—´æ¢æ—¶é—´â€ï¼Œä½†å—ç¼“å­˜æ˜¯ OS å±‚é¢çš„ç£ç›˜ä¼˜åŒ–ï¼ŒTLB æ˜¯ CPU å±‚é¢çš„åœ°å€æ˜ å°„ä¼˜åŒ–ã€‚</p>
<p><strong>Exercise 5.6</strong> <code>fs/fs.c</code> ä¸­çš„ <code>disk_addr</code> å‡½æ•°ç”¨æ¥è®¡ç®—æŒ‡å®šç£ç›˜å—å¯¹åº”çš„è™šå­˜åœ°å€ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> *<span class="title function_">disk_addr</span><span class="params">(u_int blockno)</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> (<span class="type">void</span> *)(DISKMAP + blockno * BLOCK_SIZE);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Exercise 5.7</strong> å®ç° <code>map_block</code> å‡½æ•°å’Œ <code>unmap_block</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">map_block</span><span class="params">(u_int blockno)</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> (block_is_mapped(blockno)) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> syscall_mem_alloc(<span class="number">0</span>, disk_addr(blockno), PTE_D);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">unmap_block</span><span class="params">(u_int blockno)</span> &#123;</span><br><span class="line">	<span class="type">void</span> *va;</span><br><span class="line">	va = block_is_mapped(blockno);</span><br><span class="line">    <span class="comment">//å°†è¿™ä¸ªå—çš„å†…å®¹ä»å†…å­˜å†™å›ç£ç›˜ï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤±ã€‚</span></span><br><span class="line">	<span class="keyword">if</span> (!block_is_free(blockno) &amp;&amp; block_is_dirty(blockno)) &#123;</span><br><span class="line">		write_block(blockno);</span><br><span class="line">	&#125;</span><br><span class="line">	panic_on(syscall_mem_unmap(<span class="number">0</span>, va));</span><br><span class="line">    <span class="comment">//æœ€åçš„æ–­è¨€ï¼šç¡®è®¤å–æ¶ˆæ˜ å°„åï¼Œè¿™ä¸ªå—çœŸçš„æ²¡å†è¢«æ˜ å°„äº†ã€‚</span></span><br><span class="line">	user_assert(!block_is_mapped(blockno));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…¶ä»–å‡½æ•°ï¼š</p>
<p>read_block å‡½æ•°å’Œ write_block å‡½æ•°ç”¨äºè¯»å†™ç£ç›˜å—ã€‚read_block å‡½æ•°å°†æŒ‡å®šç¼–å·çš„ç£ç›˜å—è¯»å…¥åˆ°å†…å­˜ä¸­ï¼Œé¦–å…ˆæ£€æŸ¥è¿™å—ç£ç›˜å—æ˜¯å¦å·²ç»åœ¨å†…å­˜ä¸­ï¼Œå¦‚æœä¸åœ¨ï¼Œå…ˆåˆ†é…ä¸€é¡µç‰©ç†å†…å­˜ï¼Œç„¶åè°ƒç”¨ ide_read å‡½æ•°æ¥è¯»å–ç£ç›˜ä¸Šçš„æ•°æ®åˆ°å¯¹åº”çš„è™šå­˜åœ°å€å¤„ã€‚</p>
<p>file_get_block å‡½æ•°ç”¨äº<strong>å°†æŸä¸ªæŒ‡å®šçš„æ–‡ä»¶æŒ‡å‘çš„ç£ç›˜å—è¯»å…¥å†…å­˜</strong>ã€‚</p>
<p>åœ¨å®Œæˆå—ç¼“å­˜éƒ¨åˆ†<strong>ä¹‹å</strong>æˆ‘ä»¬å°±å¯ä»¥å®ç°æ–‡ä»¶ç³»ç»Ÿä¸­çš„ä¸€äº›æ–‡ä»¶æ“ä½œäº†ã€‚</p>
<p>ï¼ˆæœ€å¼€å§‹æƒ³éª‚äººå› ä¸ºè§‰å¾—æŒ‡å¯¼ä¹¦æ ¹æœ¬æ²¡å†™æˆ‘ä»¬åˆè¿”å›æ–‡ä»¶æ“ä½œäº†ï¼Œï¼Œç›´åˆ°æˆ‘å‘ç°å…¶å®æŒ‡å¯¼ä¹¦å†™äº†ï¼Œï¼Œã€‚ã€‚ä½†æ˜¯æˆ‘è¿˜æ˜¯æƒ³éª‚äººï¼Œå› ä¸ºä»–å†™å¾—ä¸€ç‚¹éƒ½ä¸æ˜æ˜¾ã€‚ã€‚ã€‚ã€‚ï¼‰</p>
<p><strong>Exercise 5.8</strong> è¡¥å…¨ <code>dir_lookup</code> å‡½æ•°ï¼ŒæŸ¥æ‰¾æŸä¸ªç›®å½•ä¸‹æ˜¯å¦å­˜åœ¨æŒ‡å®šçš„æ–‡ä»¶ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">dir_lookup</span><span class="params">(<span class="keyword">struct</span> File *dir, <span class="type">char</span> *name, <span class="keyword">struct</span> File **file)</span> &#123;</span><br><span class="line">	u_int nblock;</span><br><span class="line">	nblock = dir-&gt;f_size / BLOCK_SIZE;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; nblock; i++) &#123;</span><br><span class="line">		<span class="type">void</span> *blk;</span><br><span class="line">		try(file_get_block(dir, i, &amp;blk));</span><br><span class="line">		<span class="class"><span class="keyword">struct</span> <span class="title">File</span> *<span class="title">files</span> =</span> (<span class="keyword">struct</span> File *)blk;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">struct</span> File *f = files; f &lt; files + FILE2BLK; ++f) &#123;</span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">strcmp</span>(name, f-&gt;f_name) == <span class="number">0</span>) &#123;</span><br><span class="line">				*file = f;</span><br><span class="line">				f-&gt;f_dir = dir;</span><br><span class="line">				<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> -E_NOT_FOUND;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒéƒ¨åˆ†è‡³æ­¤ä¹Ÿå®Œæˆå•¦ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯å®ç°ç”¨æˆ·æ¥å£ã€‚</p>
<h3 id="4-æ–‡ä»¶ç³»ç»Ÿçš„ç”¨æˆ·æ¥å£"><a href="#4-æ–‡ä»¶ç³»ç»Ÿçš„ç”¨æˆ·æ¥å£" class="headerlink" title="4 æ–‡ä»¶ç³»ç»Ÿçš„ç”¨æˆ·æ¥å£"></a>4 æ–‡ä»¶ç³»ç»Ÿçš„ç”¨æˆ·æ¥å£</h3><h4 id="4-1-æ–‡ä»¶æè¿°ç¬¦"><a href="#4-1-æ–‡ä»¶æè¿°ç¬¦" class="headerlink" title="4.1 æ–‡ä»¶æè¿°ç¬¦"></a>4.1 æ–‡ä»¶æè¿°ç¬¦</h4><h5 id="ğŸ’¡1-ä»€ä¹ˆæ˜¯æ–‡ä»¶æè¿°ç¬¦ï¼ˆfdï¼‰ï¼Ÿ"><a href="#ğŸ’¡1-ä»€ä¹ˆæ˜¯æ–‡ä»¶æè¿°ç¬¦ï¼ˆfdï¼‰ï¼Ÿ" class="headerlink" title="ğŸ’¡1. ä»€ä¹ˆæ˜¯æ–‡ä»¶æè¿°ç¬¦ï¼ˆfdï¼‰ï¼Ÿ"></a>ğŸ’¡1. ä»€ä¹ˆæ˜¯æ–‡ä»¶æè¿°ç¬¦ï¼ˆfdï¼‰ï¼Ÿ</h5><ul>
<li>å½“ç”¨æˆ·ç¨‹åºè¦<strong>æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶</strong>æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¸ä¼šç›´æ¥æŠŠæ–‡ä»¶æš´éœ²ç»™ä½ ï¼Œè€Œæ˜¯ç»™ä½ ä¸€ä¸ªç¼–å·ï¼ˆæ•´æ•°ï¼‰ï¼Œè¿™å°±æ˜¯<strong>fdï¼ˆæ–‡ä»¶æè¿°ç¬¦ï¼‰</strong>ã€‚</li>
<li>ä½ å¯ä»¥ç”¨è¿™ä¸ª fd æ¥<strong>è¯»å–ã€å†™å…¥ã€å…³é—­æ–‡ä»¶</strong>ï¼Œæ“ä½œç³»ç»Ÿä¼šå¸®ä½ å®ŒæˆçœŸå®çš„æ–‡ä»¶æ“ä½œã€‚</li>
<li>å®ƒå°±åƒä½ åœ¨å›¾ä¹¦é¦†å€Ÿä¹¦ï¼Œæ‹¿åˆ°ä¸€ä¸ªå‡­æ¡ï¼ˆfdï¼‰ï¼Œä»¥åä½ å°±å‡­è¿™ä¸ªå‡­æ¡å»è¯»ä¹¦ã€è¿˜ä¹¦ã€‚</li>
</ul>
<h5 id="ğŸ§ 2-æ–‡ä»¶æè¿°ç¬¦å†…éƒ¨å…¶å®å­˜äº†å¾ˆå¤šä¿¡æ¯"><a href="#ğŸ§ 2-æ–‡ä»¶æè¿°ç¬¦å†…éƒ¨å…¶å®å­˜äº†å¾ˆå¤šä¿¡æ¯" class="headerlink" title="ğŸ§ 2. æ–‡ä»¶æè¿°ç¬¦å†…éƒ¨å…¶å®å­˜äº†å¾ˆå¤šä¿¡æ¯"></a>ğŸ§ 2. æ–‡ä»¶æè¿°ç¬¦å†…éƒ¨å…¶å®å­˜äº†å¾ˆå¤šä¿¡æ¯</h5><p>ä¸ºäº†çœŸæ­£æ‰§è¡Œâ€œæ‰“å¼€â€â€œè¯»â€â€œå†™â€ç­‰æ“ä½œï¼Œæ“ä½œç³»ç»Ÿå¿…é¡»è®°å½•æ¯ä¸ªæ–‡ä»¶çš„ï¼š</p>
<p>è¿™äº›ä¿¡æ¯å­˜åœ¨ä¸€ä¸ªç»“æ„ä½“é‡Œï¼Œæ¯”å¦‚è¿™ä¸ªï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cå¤åˆ¶ç¼–è¾‘struct Fd &#123;</span><br><span class="line">  u_int fd_dev_id;   // è®¾å¤‡å·ï¼ˆæ¯”å¦‚æ–‡ä»¶ã€ç»ˆç«¯ã€ç®¡é“ï¼‰</span><br><span class="line">  u_int fd_offset;   // å½“å‰è¯»å†™åˆ°å“ªäº†</span><br><span class="line">  u_int fd_omode;    // æ‰“å¼€æ–¹å¼</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h5 id="ğŸ“¦3-Filefd-æ˜¯-Fd-çš„â€œå‡çº§ç‰ˆâ€"><a href="#ğŸ“¦3-Filefd-æ˜¯-Fd-çš„â€œå‡çº§ç‰ˆâ€" class="headerlink" title="ğŸ“¦3. Filefd æ˜¯ Fd çš„â€œå‡çº§ç‰ˆâ€"></a>ğŸ“¦3. Filefd æ˜¯ Fd çš„â€œå‡çº§ç‰ˆâ€</h5><p>é™¤äº†åŸºç¡€ä¿¡æ¯ï¼Œæœ‰æ—¶å€™ä½ è¿˜æƒ³ä¿å­˜æ›´å¤šï¼Œæ¯”å¦‚è¿™ä¸ªæ–‡ä»¶å®é™…åœ¨ç£ç›˜ä¸Šçš„ä¿¡æ¯ï¼ˆå¤§å°ã€ç›®å½•ç­‰ï¼‰ï¼Œäºæ˜¯å°±ç”¨ä¸€ä¸ªæ›´å¤§çš„ç»“æ„ä½“ <code>Filefd</code>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cå¤åˆ¶ç¼–è¾‘struct Filefd &#123;</span><br><span class="line">  struct Fd f_fd;     // å‰é¢å°±æ˜¯ Fd çš„å†…å®¹</span><br><span class="line">  u_int f_fileid;     // æ–‡ä»¶ID</span><br><span class="line">  struct File f_file; // æ–‡ä»¶æœ¬ä½“ä¿¡æ¯ï¼ˆç£ç›˜å—ç­‰ï¼‰</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ª <code>Filefd</code> å°±æ˜¯æŠŠ <code>Fd</code> å½“ä½œå¼€å¤´ï¼Œâ€œæ‰©å±•â€äº†å®ƒã€‚æ‰€ä»¥ï¼š</p>
<ul>
<li><code>Filefd</code> å¯ä»¥å½“ä½œ <code>Fd</code> ç”¨</li>
<li>ä½ ä¹Ÿå¯ä»¥æŠŠ <code>Fd *</code> å¼ºåˆ¶è½¬æ¢æˆ <code>Filefd *</code>ï¼Œç»§ç»­æ“ä½œæ‰©å±•ä¿¡æ¯ï¼ˆè¿™å°±æ˜¯Cè¯­è¨€çš„ç‰¹æ€§å•¦ï¼‰</li>
</ul>
<p><strong>Exercise 5.9</strong> è¯·å®Œæˆ user&#x2F;lib&#x2F;file.c ä¸­çš„ open å‡½æ•°ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">open</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *path, <span class="type">int</span> mode)</span> &#123;</span><br><span class="line">	<span class="type">int</span> r;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">Fd</span> *<span class="title">fd</span>;</span></span><br><span class="line">    <span class="comment">//ç”³è¯·ä¸€ä¸ªfdç©ºä½</span></span><br><span class="line">	r = fd_alloc(&amp;fd);</span><br><span class="line">	<span class="keyword">if</span> (r) &#123;</span><br><span class="line">		<span class="keyword">return</span> r;</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="comment">//å‘é€openè¯·æ±‚ç»™æ–‡ä»¶ç³»ç»ŸæœåŠ¡</span></span><br><span class="line">	r = fsipc_open(path, mode, fd);</span><br><span class="line">	<span class="keyword">if</span> (r) &#123;</span><br><span class="line">		<span class="keyword">return</span> r;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">char</span> *va;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">Filefd</span> *<span class="title">ffd</span>;</span></span><br><span class="line">	u_int size, fileid;</span><br><span class="line">    <span class="comment">//fd2data(fd) å¾—åˆ°çš„æ˜¯ä¸è¿™ä¸ª fd å¯¹åº”çš„æ–‡ä»¶å†…å®¹ç¼“å­˜åŒºçš„è™šæ‹Ÿåœ°å€</span></span><br><span class="line">	va = fd2data(fd);</span><br><span class="line">	ffd = (<span class="keyword">struct</span> Filefd *)fd;</span><br><span class="line">    <span class="comment">//è¯»å–æ–‡ä»¶å¤§å°å’ŒID</span></span><br><span class="line">	size = ffd-&gt;f_file.f_size;</span><br><span class="line">	fileid = ffd-&gt;f_fileid;</span><br><span class="line">    <span class="comment">//æŠŠæ•´ä¸ªæ–‡ä»¶å†…å®¹æ˜ å°„åˆ°å†…å­˜ä¸­ï¼Œæœ€ç»ˆå¯ä»¥åƒæ“ä½œæ™®é€šå†…å­˜ä¸€æ ·æ“ä½œæ–‡ä»¶å†…å®¹å•¦~</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; size; i += PTMAP) &#123;</span><br><span class="line">		r = fsipc_map(fileid, i, va + i);</span><br><span class="line">		<span class="keyword">if</span> (r) &#123;</span><br><span class="line">			<span class="keyword">return</span> r;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="comment">//è¿”å›è¿™ä¸ª fd çš„ç¼–å·</span></span><br><span class="line">	<span class="keyword">return</span> fd2num(fd);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Exercise 5.10</strong> å‚è€ƒ user&#x2F;lib&#x2F;fd.c ä¸­çš„ write å‡½æ•°ï¼Œå®Œæˆ read å‡½æ•°ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">read</span><span class="params">(<span class="type">int</span> fdnum, <span class="type">void</span> *buf, u_int n)</span> &#123;</span><br><span class="line">	<span class="type">int</span> r;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">Dev</span> *<span class="title">dev</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">Fd</span> *<span class="title">fd</span>;</span></span><br><span class="line">    <span class="comment">//æ‰¾æ–‡ä»¶æ ‡è¯†ç¬¦</span></span><br><span class="line">	<span class="keyword">if</span> ((r = fd_lookup(fdnum, &amp;fd)) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> r;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//æ‰¾è®¾å¤‡</span></span><br><span class="line">	<span class="keyword">if</span> ((r = dev_lookup(fd-&gt;fd_dev_id, &amp;dev)) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> r;</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="comment">//æ‰¾æƒé™</span></span><br><span class="line">	<span class="keyword">if</span> ((fd-&gt;fd_omode &amp; O_ACCMODE) == O_WRONLY) &#123;</span><br><span class="line">		<span class="keyword">return</span> -E_INVAL;</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="comment">//å¼€å§‹è¯»</span></span><br><span class="line">	r = dev-&gt;dev_read(fd, buf, n, fd-&gt;fd_offset);</span><br><span class="line">	<span class="comment">//è®¾ç½®æ–°æŒ‡é’ˆ</span></span><br><span class="line">	<span class="keyword">if</span> (r &gt; <span class="number">0</span>) &#123;</span><br><span class="line">		fd-&gt;fd_offset += r;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-2-æ–‡ä»¶ç³»ç»ŸæœåŠ¡"><a href="#4-2-æ–‡ä»¶ç³»ç»ŸæœåŠ¡" class="headerlink" title="4.2 æ–‡ä»¶ç³»ç»ŸæœåŠ¡"></a>4.2 æ–‡ä»¶ç³»ç»ŸæœåŠ¡</h4><p>MOS æ“ä½œç³»ç»Ÿä¸­çš„æ–‡ä»¶ç³»ç»ŸæœåŠ¡é€šè¿‡ IPC çš„å½¢å¼ä¾›å…¶ä»–è¿›ç¨‹è°ƒç”¨ï¼Œè¿›è¡Œæ–‡ä»¶è¯»å†™æ“ä½œã€‚</p>
<p>ç”¨æˆ·è¿›ç¨‹éœ€è¦è¿›è¡Œæ–‡ä»¶æ“ä½œæ—¶ï¼Œä½¿ç”¨ ipc_sendã€ipc_recv ä¸ fs_serv è¿›è¡Œäº¤äº’</p>
<p><code>fs_serv</code> çš„ä¸»å‡½æ•°å…ˆåšåˆå§‹åŒ–å·¥ä½œï¼Œå»ºç«‹ä¸€ä¸ªâ€œæ–‡ä»¶æ‰“å¼€è¡¨â€ <code>opentab</code>ï¼Œç”¨æ¥è®°å½•æœ‰å“ªäº›æ–‡ä»¶è¢«å“ªäº›è¿›ç¨‹æ‰“å¼€äº†ã€‚</p>
<p>æ¥ç€å®ƒä¼šå»åˆå§‹åŒ–æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼ŒçŸ¥é“ç£ç›˜ç»“æ„æ€ä¹ˆç»„ç»‡çš„ï¼Œå“ªäº›å—æ˜¯ç©ºçš„ã€å“ªäº›å—å·²ç»å†™äº†å†…å®¹ã€‚</p>
<p>æ‰€æœ‰æ–‡ä»¶ç³»ç»Ÿéƒ½é ä¸€ä¸ªå«â€œè¶…çº§å—â€çš„ç»“æ„æ¥è®°å½•æ•´ä¸ªç£ç›˜çš„å¸ƒå±€ï¼Œ<code>fs_init</code> é¦–å…ˆå°±æ˜¯æŠŠè¶…çº§å—è¯»è¿›æ¥äº†è§£ç£ç›˜çš„åŸºæœ¬æƒ…å†µã€‚</p>
<p>ä¸€åˆ‡å‡†å¤‡å°±ç»ªåï¼Œå®ƒå°±â€œä¸Šçº¿è¥ä¸šâ€å•¦ï¼Œå¼€å§‹è°ƒç”¨ <code>serve()</code> æŒç»­å¾ªç¯åœ°ç­‰å¾…å’Œå¤„ç†ç”¨æˆ·ç¨‹åºçš„ IPC è¯·æ±‚ã€‚</p>
<h5 id="ğŸ’¡-ç¬¬ä¸€éƒ¨åˆ†ï¼šæ–‡ä»¶ç³»ç»Ÿæ”¯æŒçš„æ“ä½œç±»å‹å®šä¹‰"><a href="#ğŸ’¡-ç¬¬ä¸€éƒ¨åˆ†ï¼šæ–‡ä»¶ç³»ç»Ÿæ”¯æŒçš„æ“ä½œç±»å‹å®šä¹‰" class="headerlink" title="ğŸ’¡ ç¬¬ä¸€éƒ¨åˆ†ï¼šæ–‡ä»¶ç³»ç»Ÿæ”¯æŒçš„æ“ä½œç±»å‹å®šä¹‰"></a>ğŸ’¡ ç¬¬ä¸€éƒ¨åˆ†ï¼šæ–‡ä»¶ç³»ç»Ÿæ”¯æŒçš„æ“ä½œç±»å‹å®šä¹‰</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cå¤åˆ¶ç¼–è¾‘enum &#123;</span><br><span class="line">  FSREQ_OPEN,      // æ‰“å¼€æ–‡ä»¶</span><br><span class="line">  FSREQ_MAP,       // æ˜ å°„æ–‡ä»¶å†…å®¹åˆ°å†…å­˜</span><br><span class="line">  FSREQ_SET_SIZE,  // ä¿®æ”¹æ–‡ä»¶å¤§å°</span><br><span class="line">  FSREQ_CLOSE,     // å…³é—­æ–‡ä»¶</span><br><span class="line">  FSREQ_DIRTY,     // æ ‡è®°æ–‡ä»¶ä¸ºå·²ä¿®æ”¹</span><br><span class="line">  FSREQ_REMOVE,    // åˆ é™¤æ–‡ä»¶ â† ä½ è¦å®ç°çš„åŠŸèƒ½</span><br><span class="line">  FSREQ_SYNC,      // åŒæ­¥ç£ç›˜</span><br><span class="line">  MAX_FSREQNO,     // è¯·æ±‚ç±»å‹çš„æ€»æ•°</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>ğŸ“Œ æ–‡ä»¶ç³»ç»Ÿæ”¯æŒçš„æ“ä½œéƒ½ç”¨è¿™ç±»æšä¸¾å€¼ <code>FSREQ_*</code> æ¥æ ‡è¯†ã€‚ä¾‹å¦‚ï¼š</p>
<ul>
<li>å½“ç”¨æˆ·æƒ³<strong>æ‰“å¼€æ–‡ä»¶</strong>æ—¶ï¼Œå‘å‡ºçš„ IPC è¯·æ±‚ç±»å‹æ˜¯ <code>FSREQ_OPEN</code>ï¼›</li>
<li>æƒ³<strong>åˆ é™¤æ–‡ä»¶</strong>æ—¶ï¼Œå‘é€ <code>FSREQ_REMOVE</code> è¯·æ±‚ã€‚</li>
</ul>
<h5 id="ğŸ’¬-ç¬¬äºŒéƒ¨åˆ†ï¼šç”¨æˆ·æ€ä¹ˆè¯·æ±‚æ–‡ä»¶æ“ä½œï¼Ÿ"><a href="#ğŸ’¬-ç¬¬äºŒéƒ¨åˆ†ï¼šç”¨æˆ·æ€ä¹ˆè¯·æ±‚æ–‡ä»¶æ“ä½œï¼Ÿ" class="headerlink" title="ğŸ’¬ ç¬¬äºŒéƒ¨åˆ†ï¼šç”¨æˆ·æ€ä¹ˆè¯·æ±‚æ–‡ä»¶æ“ä½œï¼Ÿ"></a>ğŸ’¬ ç¬¬äºŒéƒ¨åˆ†ï¼šç”¨æˆ·æ€ä¹ˆè¯·æ±‚æ–‡ä»¶æ“ä½œï¼Ÿ</h5><blockquote>
<p>â€œç”¨æˆ·ç¨‹åºåœ¨å‘å‡ºæ–‡ä»¶ç³»ç»Ÿæ“ä½œè¯·æ±‚æ—¶ï¼Œå°†è¯·æ±‚çš„å†…å®¹æ”¾åœ¨å¯¹åº”çš„ç»“æ„ä½“ä¸­è¿›è¡Œæ¶ˆæ¯çš„ä¼ é€’ã€‚â€</p>
</blockquote>
<p>ğŸ‘‰ æ„æ€æ˜¯ï¼šç”¨æˆ·ç¨‹åºå¹¶ä¸æ˜¯ç›´æ¥è°ƒç”¨æ–‡ä»¶ç³»ç»Ÿçš„å†…éƒ¨å‡½æ•°ï¼Œè€Œæ˜¯ï¼š</p>
<ol>
<li>æŠŠè¯·æ±‚å†…å®¹ï¼ˆæ¯”å¦‚è·¯å¾„ã€æ‰“å¼€æ¨¡å¼ã€è¦åˆ é™¤å“ªä¸ªæ–‡ä»¶ï¼‰å¡«è¿›ä¸€ä¸ªç»“æ„ä½“ï¼›</li>
<li>é€šè¿‡ IPC æŠŠè¿™ä¸ªç»“æ„ä½“å‘é€ç»™æ–‡ä»¶ç³»ç»ŸæœåŠ¡è¿›ç¨‹ <code>fs_serv</code>ï¼›</li>
<li><code>fs_serv</code> æ ¹æ®ä½ å¡«çš„è¯·æ±‚ç±»å‹ï¼ˆæ¯”å¦‚æ˜¯ <code>FSREQ_REMOVE</code>ï¼‰å’Œå‚æ•°ï¼Œæ¥åšç›¸åº”æ“ä½œã€‚</li>
</ol>
<h5 id="ğŸ§ -ç¬¬ä¸‰éƒ¨åˆ†ï¼šfs-serv-æ€ä¹ˆå¤„ç†è¿™äº›è¯·æ±‚ï¼Ÿ"><a href="#ğŸ§ -ç¬¬ä¸‰éƒ¨åˆ†ï¼šfs-serv-æ€ä¹ˆå¤„ç†è¿™äº›è¯·æ±‚ï¼Ÿ" class="headerlink" title="ğŸ§  ç¬¬ä¸‰éƒ¨åˆ†ï¼šfs_serv æ€ä¹ˆå¤„ç†è¿™äº›è¯·æ±‚ï¼Ÿ"></a>ğŸ§  ç¬¬ä¸‰éƒ¨åˆ†ï¼šfs_serv æ€ä¹ˆå¤„ç†è¿™äº›è¯·æ±‚ï¼Ÿ</h5><blockquote>
<p>â€œfs_serv è¿›ç¨‹æ”¶åˆ°å…¶ä»–è¿›ç¨‹çš„ IPC è¯·æ±‚åï¼ŒIPC ä¼ é€’çš„æ¶ˆæ¯åŒ…å«äº†è¯·æ±‚çš„ç±»å‹å’Œå…¶ä»–å¿…è¦çš„å‚æ•°ï¼Œæ ¹æ®è¯·æ±‚çš„ç±»å‹æ‰§è¡Œç›¸åº”çš„æ–‡ä»¶æ“ä½œï¼ˆæ–‡ä»¶çš„å¢ã€åˆ ã€æ”¹ã€æŸ¥ç­‰ï¼‰ã€‚â€</p>
</blockquote>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼š</p>
<ul>
<li><code>fs_serv</code> æ˜¯ä¸€ä¸ªâ€œæ–‡ä»¶æœåŠ¡ä¸­å¿ƒâ€ï¼Œéšæ—¶ç›‘å¬æ˜¯å¦æœ‰ IPC è¯·æ±‚ã€‚</li>
<li>å®ƒæ¥åˆ°ä¸€ä¸ªè¯·æ±‚åï¼Œå…ˆçœ‹è¿™ä¸ªè¯·æ±‚çš„ç±»å‹ï¼ˆæ¯”å¦‚æ˜¯ <code>FSREQ_REMOVE</code>ï¼‰ã€‚</li>
<li>ç„¶åå»æ‰§è¡Œç›¸åº”çš„æ–‡ä»¶æ“ä½œé€»è¾‘ï¼ˆæ¯”å¦‚æŸ¥æ‰¾è¿™ä¸ªè·¯å¾„ã€ä»ç£ç›˜ä¸Šåˆ é™¤æ–‡ä»¶ç»“æ„ç­‰ç­‰ï¼‰ã€‚</li>
<li>æœ€åé€šè¿‡ IPC æŠŠç»“æœï¼ˆæˆåŠŸ&#x2F;å¤±è´¥ï¼‰è¿”å›ç»™è¯·æ±‚å®ƒçš„ç”¨æˆ·è¿›ç¨‹ã€‚</li>
</ul>
<p><strong>Exercise 5.11</strong> å®Œæˆ fs&#x2F;serv.c ä¸­çš„ serve_remove å‡½æ•°ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">serve_remove</span><span class="params">(u_int envid, <span class="keyword">struct</span> Fsreq_remove *rq)</span> &#123;</span><br><span class="line">	<span class="type">int</span> r;</span><br><span class="line">	r = file_remove(rq-&gt;req_path);</span><br><span class="line">	ipc_send(envid, r, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Exercise 5.12</strong> å®Œæˆ user&#x2F;lib&#x2F;fsipc.c ä¸­çš„ fsipc_remove å‡½æ•°ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">fsipc_remove</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *path)</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> (path[<span class="number">0</span>] == <span class="string">&#x27;\0&#x27;</span> || <span class="built_in">strlen</span>(path) &gt;= MAXPATHLEN) &#123;</span><br><span class="line">		<span class="keyword">return</span> -E_BAD_PATH;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">Fsreq_remove</span> *<span class="title">req</span> =</span> (<span class="keyword">struct</span> Fsreq_remove *)fsipcbuf;</span><br><span class="line">	<span class="built_in">strcpy</span>((<span class="type">char</span> *)req-&gt;req_path, path);</span><br><span class="line">	<span class="keyword">return</span> fsipc(FSREQ_REMOVE, req, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Exercise 5.13</strong> å®Œæˆ user&#x2F;lib&#x2F;file.c ä¸­çš„ remove å‡½æ•°ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">remove</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *path)</span> </span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">fsipc_remove</span><span class="params">(path)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><code>remove</code>ï¼ˆuser&#x2F;lib&#x2F;file.cï¼‰</strong></p>
<ul>
<li>è¿™æ˜¯ç”¨æˆ·è¿›ç¨‹è°ƒç”¨çš„æ¥å£å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ·ä»£ç é‡Œè°ƒç”¨ <code>remove(path)</code> å°±ä¼šæ‰§è¡Œè¿™ä¸ªå‡½æ•°ã€‚</li>
<li>å®ƒå®é™…ä¸Šè°ƒç”¨äº† <code>fsipc_remove</code>ï¼ŒæŠŠåˆ é™¤è¯·æ±‚è½¬å‘ç»™æ–‡ä»¶ç³»ç»ŸæœåŠ¡ã€‚</li>
</ul>
<p><strong><code>fsipc_remove</code>ï¼ˆuser&#x2F;lib&#x2F;fsipc.cï¼‰</strong></p>
<ul>
<li>è¿™æ˜¯ç”¨æˆ·è¿›ç¨‹å’Œæ–‡ä»¶ç³»ç»ŸæœåŠ¡ä¹‹é—´çš„ IPC é€šä¿¡å±‚å‡½æ•°ã€‚</li>
<li>å®ƒè´Ÿè´£æŠŠåˆ é™¤è¯·æ±‚ï¼ˆè·¯å¾„ä¿¡æ¯ï¼‰å°è£…æˆæ¶ˆæ¯ï¼Œé€šè¿‡ IPC å‘é€ç»™æ–‡ä»¶ç³»ç»ŸæœåŠ¡è¿›ç¨‹ã€‚</li>
<li>ç±»ä¼¼äºâ€œæ¶ˆæ¯æ‰“åŒ…+å‘å‡ºâ€çš„è§’è‰²ã€‚</li>
</ul>
<p><strong><code>serve_remove</code>ï¼ˆfs&#x2F;serv.cï¼‰</strong></p>
<ul>
<li>è¿™æ˜¯æ–‡ä»¶ç³»ç»ŸæœåŠ¡è¿›ç¨‹æ¥æ”¶åˆ°åˆ é™¤è¯·æ±‚åçš„å¤„ç†å‡½æ•°ã€‚</li>
<li>å®ƒè°ƒç”¨å†…æ ¸çº§çš„ <code>file_remove</code> å‡½æ•°æ‰§è¡ŒçœŸæ­£çš„åˆ é™¤æ“ä½œã€‚</li>
<li>å¤„ç†å®Œåï¼ŒæŠŠåˆ é™¤ç»“æœé€šè¿‡ IPC å‘é€å›ç”¨æˆ·è¿›ç¨‹ã€‚</li>
</ul>
<p><strong><code>file_remove</code>ï¼ˆfs&#x2F;file.cï¼‰</strong></p>
<ul>
<li>è¿™æ˜¯æ–‡ä»¶ç³»ç»Ÿçš„åº•å±‚å…·ä½“å®ç°å‡½æ•°ï¼ŒçœŸæ­£ä¿®æ”¹ç£ç›˜æ•°æ®ç»“æ„ï¼Œé‡Šæ”¾ç£ç›˜å—ï¼Œæ›´æ–°ç›®å½•ç­‰ã€‚</li>
<li>æ˜¯åˆ é™¤æ“ä½œçš„æ ¸å¿ƒå®ç°ï¼Œè´Ÿè´£å®Œæˆâ€œåˆ é™¤æ–‡ä»¶â€çš„å®é™…å·¥ä½œã€‚</li>
</ul>
<h5 id="ğŸ§ -æ€»ç»“ä¸€å¥è¯"><a href="#ğŸ§ -æ€»ç»“ä¸€å¥è¯" class="headerlink" title="ğŸ§  æ€»ç»“ä¸€å¥è¯"></a>ğŸ§  æ€»ç»“ä¸€å¥è¯</h5><blockquote>
<p><code>file.c</code> å‘èµ·è¯·æ±‚ â†’ <code>fsipc.c</code> å°è£…è¯·æ±‚å‘ IPC â†’ <code>serv.c</code> ä¸»å¾ªç¯æ´¾å‘å¤„ç† â†’ <code>fs.c</code> æ‰§è¡Œé€»è¾‘ â†’ <code>ide.c</code> æ“ä½œç£ç›˜ã€‚</p>
</blockquote>
<p>åŒæ—¶ï¼Œæ„Ÿè§‰è¿™ä¸ªå±‚çº§å…³ç³»ä¸€ç›´åœ¨lab5ä¸­æœ‰æ‰€æ¶‰åŠã€‚ã€‚ã€‚æ‰€ä»¥æˆ‘ä¹Ÿæ€»ç»“äº†ä¸€äº›åˆ«çš„å±‚çº§ï¼</p>
<blockquote>
<p>ç”¨æˆ·æ€ â†’ <code>read()</code> â†’ <code>file_read()</code> â†’ <code>ide_read()</code> â†’ <code>syscall_read_dev()</code> â†’ <code>sys_read_dev()</code> â†’ è¯»å–å¯„å­˜å™¨æ•°æ® â†’ è¿”å›å†…å®¹</p>
</blockquote>
<ul>
<li><p><code>tools/fsformat.c:create_file</code>ï¼šåœ¨ <strong>æ„å»ºç£ç›˜é•œåƒé˜¶æ®µ</strong>ï¼Œå¾€ç©ºç™½ç£ç›˜ä¸Šå†™å…¥åˆå§‹æ–‡ä»¶ï¼ˆåˆ›å»ºæ ¹ç›®å½•ã€æ–‡ä»¶ç­‰ï¼‰ã€‚å®ƒæ˜¯ç¦»çº¿æ“ä½œï¼Œåœ¨ç”¨æˆ·ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿå‰æ‰§è¡Œã€‚</p>
<p>ğŸ› ï¸ æ–‡ä»¶ç³»ç»Ÿæ„å»ºé˜¶æ®µï¼ˆ<code>tools/fsformat.c</code>ï¼‰</p>
<p>âš™ï¸ è¿è¡Œæ—¶æ–‡ä»¶ç³»ç»ŸæœåŠ¡ï¼ˆ<code>fs/fs.c</code>, <code>fs/serv.c</code>ï¼‰</p>
</li>
</ul>
<h3 id="ğŸ§±-Lab5-æ¶‰åŠçš„å››ä¸ªå…³é”®å±‚çº§ï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š"><a href="#ğŸ§±-Lab5-æ¶‰åŠçš„å››ä¸ªå…³é”®å±‚çº§ï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š" class="headerlink" title="ğŸ§± Lab5 æ¶‰åŠçš„å››ä¸ªå…³é”®å±‚çº§ï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š"></a>ğŸ§± Lab5 æ¶‰åŠçš„å››ä¸ªå…³é”®å±‚çº§ï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š</h3><table>
<thead>
<tr>
<th>å±‚çº§</th>
<th>æ–‡ä»¶</th>
<th>ä½œç”¨</th>
<th>ä¸¾ä¾‹å‡½æ•°</th>
</tr>
</thead>
<tbody><tr>
<td>ğŸŸ© <strong>åº”ç”¨å±‚ï¼ˆç”¨æˆ·åº“ï¼‰</strong></td>
<td><code>user/lib/file.c</code>, <code>fsipc.c</code></td>
<td>å‘å‡ºæ–‡ä»¶æ“ä½œè¯·æ±‚</td>
<td><code>remove()</code>, <code>fsipc_remove()</code></td>
</tr>
<tr>
<td>ğŸŸ¨ <strong>æ–‡ä»¶ç³»ç»ŸæœåŠ¡ï¼ˆæœåŠ¡ç«¯ï¼‰</strong></td>
<td><code>fs/serv.c</code>, <code>fs/fs.c</code></td>
<td>æ¥æ”¶ IPC è¯·æ±‚å¹¶è°ƒç”¨æ ¸å¿ƒé€»è¾‘</td>
<td><code>serve_remove()</code>, <code>file_remove()</code></td>
</tr>
<tr>
<td>ğŸŸ¦ <strong>ç£ç›˜æ“ä½œå±‚ï¼ˆè®¾å¤‡é©±åŠ¨ï¼‰</strong></td>
<td><code>fs/ide.c</code></td>
<td>é€šè¿‡å¯„å­˜å™¨æ“ä½œ IDE ç£ç›˜</td>
<td><code>ide_read()</code>, <code>ide_write()</code></td>
</tr>
<tr>
<td>ğŸŸ¥ <strong>å†…æ ¸ç³»ç»Ÿè°ƒç”¨å±‚</strong></td>
<td><code>syscall.c</code>, <code>dev.c</code></td>
<td>è®¾å¤‡è¯»å†™æ¥å£å°è£…ï¼Œå®é™…è®¿é—®å¯„å­˜å™¨</td>
<td><code>syscall_read_dev()</code>, <code>syscall_write_dev()</code></td>
</tr>
</tbody></table>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="http://Nice2cu22.github.io">Nice2cu</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="http://nice2cu22.github.io/2025/05/27/OS_Lab5/">http://nice2cu22.github.io/2025/05/27/OS_Lab5/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/BUAA-OS/">BUAA_OS</a></div><div class="post-share"><div class="social-share" data-image="/img/top-default.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/05/08/OS_Lab4/" title="OS-Lab4"><img class="cover" src="/img/top-default.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">OS-Lab4</div></div><div class="info-2"><div class="info-item-1">#OS-Lab4 OS_Lab4æ„Ÿè§‰lab4å’Œlab3éƒ½æ¯”lab2å¥½ä¸€äº›ï¼Œç¬¨äººä»¥ä¸ºäº”ä¸€ç©è„±äº†ä¹‹åæ ¹æœ¬æ¥ä¸åŠå­¦äº†ï¼Œï¼Œï¼Œæ²¡æƒ³åˆ°çœ‹ç€ç«Ÿç„¶è¿˜è¡Œã€‚ã€‚ã€‚å¯èƒ½è¿™å°±æ˜¯å—lab2å’Œlab3æ‘§æ®‹ä¹‹åçš„ç»“æœå§ï¼Œè¿™ç¯‡æ–‡ç« è®°å½•ä¸€ä¸‹å­¦ä¹ lab4çš„å¿ƒè·¯å†ç¨‹ã€‚å…¶å®æ›´é‡è¦çš„æ˜¯æƒ³è‡ªå·±å†™ä¸€éåŠ æ·±ä¸€ä¸‹å°è±¡ï¼ ä»å®éªŒç›®çš„å¼€å§‹ï¼š  æŒæ¡ç³»ç»Ÿè°ƒç”¨çš„æ¦‚å¿µåŠæµç¨‹ å®ç°è¿›ç¨‹é—´é€šä¿¡æœºåˆ¶ å®ç° fork å‡½æ•° æŒæ¡é¡µå†™å…¥å¼‚å¸¸çš„å¤„ç†æµç¨‹  1.ç³»ç»Ÿè°ƒç”¨1.1 ç”¨æˆ·æ€ä¸å†…æ ¸æ€ ç”¨æˆ·è¿›ç¨‹åœ¨ç‰¹å®šåœºæ™¯ä¸‹éœ€è¦æ‰§è¡Œåªèƒ½ç”±å†…æ ¸å®Œæˆçš„æ“ä½œï¼ˆå¦‚ç¡¬ä»¶æ“ä½œã€åŠ¨æ€åˆ†é…å†…å­˜ã€ä¸å…¶ä»–è¿›ç¨‹è¿›è¡Œé€šä¿¡ï¼‰ã€‚ç”±äºåœ¨å†…æ ¸æ€æ‰§è¡Œç”¨æˆ·ç¨‹åºçš„ä»£ç ä¸å®‰å…¨ï¼Œå› æ­¤æ“ä½œç³»ç»Ÿè®¾è®¡äº†ä¸€ç³»åˆ—å†…æ ¸ç©ºé—´ä¸­çš„å‡½æ•°ï¼Œå½“ç”¨æˆ·è¿›è¡Œéœ€è¦æ“ä½œæ—¶ï¼Œä¼šå¼•å‘ç‰¹å®šçš„å¼‚å¸¸é™·å…¥å†…æ ¸æ€ï¼Œç”±å†…æ ¸è°ƒç”¨å¯¹åº”çš„å‡½æ•°ã€‚è¿™ç§æœºåˆ¶å«åšç³»ç»Ÿè°ƒç”¨  ç”¨æˆ·è¿›ç¨‹&amp;å†…æ ¸ï¼šè¿›ç¨‹æ˜¯èµ„æºåˆ†é…ä¸è°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œæ‹¥æœ‰ç‹¬ç«‹çš„åœ°å€ç©ºé—´ã€‚å†…æ ¸è´Ÿè´£ç®¡ç†ç³»ç»Ÿèµ„æºå’Œè°ƒåº¦è¿›ç¨‹ï¼Œä½¿å¾—è¿›ç¨‹èƒ½å¤Ÿå¹¶å‘æ‰§è¡Œã€‚äºŒè€…å¹¶ä¸æ˜¯å¯¹ç«‹çš„å­˜åœ¨ï¼Œå¯è®¤ä¸ºå†…æ ¸æ—¶å­˜åœ¨äºæ‰€æœ‰åœ°å€ç©ºé—´ä¸­çš„ä¸€æ®µä»£ç ã€‚ äººè¯ç‰ˆï¼šæ¯ä¸ªè¿›ç¨‹çš„åœ°å€ç©ºé—´è¢«åˆ’åˆ†æˆä¸¤éƒ¨åˆ†ï¼šç”¨æˆ·æ€å’Œå†…æ ¸æ€ã€‚ 1.2 ç³»ç»Ÿè°ƒç”¨å®ä¾‹ ç”¨æˆ·è°ƒç”¨...</div></div></div></a><a class="pagination-related" href="/2025/05/29/OS-Theory-Chapter1/" title="OS-Theory-Chapter1"><img class="cover" src="/img/top-default.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">OS-Theory-Chapter1</div></div><div class="info-2"><div class="info-item-1">OS-Theory-Chapter11.1å¼•è®ºè®¡ç®—æœºç³»ç»Ÿå¯åˆ†ä¸ºå››ä¸ªç»„æˆéƒ¨åˆ†ï¼šç¡¬ä»¶ã€æ“ä½œç³»ç»Ÿã€åº”ç”¨ç¨‹åºã€ç”¨æˆ· æ“ä½œç³»ç»Ÿæ˜¯åœ¨ç¡¬ä»¶å’Œåº”ç”¨ä¹‹é—´çš„è½¯ä»¶å±‚ 1.2æ“ä½œç³»ç»Ÿç®€å²1ã€äººå·¥æ“ä½œé˜¶æ®µï¼šäººå·¥æ“ä½œâ€”â€”ç©¿å­”çº¸å¸¦  ä¼˜ç‚¹ï¼šç‹¬äº«æ•´ä¸ªèµ„æº ç¼ºç‚¹ï¼š  â€‹       ç”¨æˆ·ç‹¬å å…¨é›†èµ„æºï¼Œæ•ˆç‡ä½ä¸‹ã€‚ â€‹       CPUç­‰å¾…äººå·¥æ“ä½œâ€”â€”ç”¨æˆ·è£…å¸¦ã€å¸å¸¦æ“ä½œæ—¶CPUåŠå†…å­˜èµ„æºç©ºé—² 2ã€å•é“æ‰¹å¤„ç†ç³»ç»ŸæŠŠå¤šä¸ªä»»åŠ¡é›†ä¸­èµ·æ¥äº¤ç»™ç”µè„‘ä¸€æ¬¡æ€§å¤„ç†ï¼Œè‡ªå·±ä¼šæŒ‰é¡ºåºæ‰§è¡Œï¼Œæ¯æ¬¡åªèƒ½å¤„ç†ä¸€ä¸ªä»»åŠ¡ï¼Œäººä¸ç”¨ä¸€ç›´ç›¯ç€ã€‚  ä¼˜ç‚¹ï¼šæé«˜äº†è®¡ç®—æœºåˆ©ç”¨ç‡ï¼Œå‡å°‘äººå·¥æ“ä½œæ—¶é—´  ç¼ºç‚¹ï¼š æ— äº¤äº’æ€§ï¼šç”¨æˆ·æ— æ³•äº¤äº’ å‘¨è½¬æ—¶é—´é•¿ï¼šä½œä¸šä»æäº¤åˆ°å®Œæˆå¯èƒ½éœ€è¦æ•°å¤© å•é“ç¨‹åºè®¾è®¡é™åˆ¶ï¼šCPUå’ŒIOè®¾å¤‡æ— æ³•å¹¶è¡Œå·¥ä½œ   3ã€å¤šé“æ‰¹å¤„ç†ç³»ç»Ÿå¤šé“æ‰¹å¤„ç†ç³»ç»Ÿèƒ½åŒæ—¶è£…å¤šä¸ªä»»åŠ¡åœ¨å†…å­˜é‡Œè‡ªåŠ¨è½®æµæ‰§è¡Œï¼Œä½†ä¸­é€”ä¸èƒ½å’Œç”¨æˆ·äº¤äº’ï¼Œä»»åŠ¡åªèƒ½ä»å¤´è·‘åˆ°å°¾ã€‚  ä¼˜ç‚¹ï¼šèµ„æºåˆ©ç”¨ç‡é«˜ï¼›ç³»ç»Ÿååé‡å¤§ ç¼ºç‚¹ï¼šå¹³å‡å‘¨è½¬æ—¶é—´é•¿ï¼›æ— äº¤äº’èƒ½åŠ›  4ã€åˆ†æ—¶æ“ä½œç³»ç»Ÿï¼ˆäº¤äº’å¼ç³»ç»Ÿï¼‰åˆ†æ—¶æ“ä½œç³»ç»ŸæŠŠ CPU...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/04/22/OS-Lab3/" title="OS-Lab3"><img class="cover" src="/img/top-default.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-22</div><div class="info-item-2">OS-Lab3</div></div><div class="info-2"><div class="info-item-1">#OS-Lab3 OS_Lab3æ„Ÿè§‰lab3çœ‹ç€æ²¡æœ‰lab2é‚£ä¹ˆæ™¦æ¶©éš¾æ‡‚ï¼Œå¯èƒ½æ˜¯å†™lab2çš„æ—¶å€™å®Œå…¨æä¸æ‡‚å†…å­˜ç®¡ç†çš„æœºåˆ¶ï¼Œæä¸æ‡‚å†…æ ¸åœ°å€å’Œç”¨æˆ·åœ°å€è¿™äº›ï¼ˆè€Œä¸”ä½ åˆä¸çœ‹pptï¼‰ã€‚ç„¶åè¿™ç¯‡æ–‡ç« å°±ç®€å•è®°å½•ä¸€ä¸‹å­¦ä¹ lab3çš„å¿ƒè·¯å†ç¨‹ã€‚ é¦–å…ˆè¿˜æ˜¯ä»lab3çš„å®éªŒç›®çš„å¼€å§‹ï¼š  åˆ›å»ºä¸€ä¸ªè¿›ç¨‹å¹¶æˆåŠŸè¿è¡Œ å®ç°æ—¶é’Ÿä¸­æ–­ï¼Œé€šè¿‡æ—¶é’Ÿä¸­æ–­å†…æ ¸å¯ä»¥å†æ¬¡è·å¾—æ‰§è¡Œæƒ å®ç°è¿›ç¨‹è°ƒåº¦ï¼Œåˆ›å»ºä¸¤ä¸ªè¿›ç¨‹ï¼Œå¹¶ä¸”é€šè¿‡æ—¶é’Ÿä¸­æ–­åˆ‡æ¢è¿›ç¨‹æ‰§è¡Œ   åœ¨Lab3ä¸­å°†è¿è¡Œä¸€ä¸ªç”¨æˆ·æ¨¡å¼çš„è¿›ç¨‹ï¼šä½¿ç”¨æ•°æ®ç»“æ„è¿›ç¨‹æ§åˆ¶å—Envæ¥è·Ÿè¸ªç”¨æˆ·è¿›ç¨‹ï¼Œå¹¶å»ºç«‹ä¸€ä¸ªç®€å•çš„ç”¨æˆ·è¿›ç¨‹ï¼Œå†åŠ è½½ä¸€ä¸ªç¨‹åºé•œåƒåˆ°æŒ‡å®šçš„å†…å­˜ç©ºé—´ï¼Œè®©ä»–è¿è¡Œèµ·æ¥ã€‚  è™½ç„¶è¿™æ®µè¯æ„Ÿè§‰æœ‰å¾ˆå¤šè¯éƒ½ä¸æ˜ç™½ï¼Œæˆ‘ä»¬æ¥ä¾æ¬¡è§£é‡Šä¸€ä¸‹ï¼š  ç”¨æˆ·æ¨¡å¼ï¼š ğŸ§  ç”¨æˆ·æ¨¡å¼æ˜¯ CPU çš„ä¸€ç§â€œä½æƒé™è¿è¡ŒçŠ¶æ€â€ï¼Œæ“ä½œç³»ç»Ÿä¸­æœ‰ä¸¤ç§æ¨¡å¼ï¼š    æ¨¡å¼ ç‰¹ç‚¹    ğŸ§â€â™‚ï¸ ç”¨æˆ·æ¨¡å¼ é™åˆ¶æƒé™ï¼Œåªèƒ½è®¿é—®ç”¨æˆ·ç©ºé—´ï¼Œä¸èƒ½æ‰§è¡Œç‰¹æƒæŒ‡ä»¤   ğŸ§  å†…æ ¸æ¨¡å¼ å…¨éƒ¨æƒé™ï¼Œèƒ½æ‰§è¡Œç³»ç»ŸæŒ‡ä»¤ã€æ“ä½œç¡¬ä»¶   ä¾‹å¦‚user/hello.cã€user/fault.c è¿™äº› ELF...</div></div></div></a><a class="pagination-related" href="/2025/05/29/OS-Theory-Chapter1/" title="OS-Theory-Chapter1"><img class="cover" src="/img/top-default.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-29</div><div class="info-item-2">OS-Theory-Chapter1</div></div><div class="info-2"><div class="info-item-1">OS-Theory-Chapter11.1å¼•è®ºè®¡ç®—æœºç³»ç»Ÿå¯åˆ†ä¸ºå››ä¸ªç»„æˆéƒ¨åˆ†ï¼šç¡¬ä»¶ã€æ“ä½œç³»ç»Ÿã€åº”ç”¨ç¨‹åºã€ç”¨æˆ· æ“ä½œç³»ç»Ÿæ˜¯åœ¨ç¡¬ä»¶å’Œåº”ç”¨ä¹‹é—´çš„è½¯ä»¶å±‚ 1.2æ“ä½œç³»ç»Ÿç®€å²1ã€äººå·¥æ“ä½œé˜¶æ®µï¼šäººå·¥æ“ä½œâ€”â€”ç©¿å­”çº¸å¸¦  ä¼˜ç‚¹ï¼šç‹¬äº«æ•´ä¸ªèµ„æº ç¼ºç‚¹ï¼š  â€‹       ç”¨æˆ·ç‹¬å å…¨é›†èµ„æºï¼Œæ•ˆç‡ä½ä¸‹ã€‚ â€‹       CPUç­‰å¾…äººå·¥æ“ä½œâ€”â€”ç”¨æˆ·è£…å¸¦ã€å¸å¸¦æ“ä½œæ—¶CPUåŠå†…å­˜èµ„æºç©ºé—² 2ã€å•é“æ‰¹å¤„ç†ç³»ç»ŸæŠŠå¤šä¸ªä»»åŠ¡é›†ä¸­èµ·æ¥äº¤ç»™ç”µè„‘ä¸€æ¬¡æ€§å¤„ç†ï¼Œè‡ªå·±ä¼šæŒ‰é¡ºåºæ‰§è¡Œï¼Œæ¯æ¬¡åªèƒ½å¤„ç†ä¸€ä¸ªä»»åŠ¡ï¼Œäººä¸ç”¨ä¸€ç›´ç›¯ç€ã€‚  ä¼˜ç‚¹ï¼šæé«˜äº†è®¡ç®—æœºåˆ©ç”¨ç‡ï¼Œå‡å°‘äººå·¥æ“ä½œæ—¶é—´  ç¼ºç‚¹ï¼š æ— äº¤äº’æ€§ï¼šç”¨æˆ·æ— æ³•äº¤äº’ å‘¨è½¬æ—¶é—´é•¿ï¼šä½œä¸šä»æäº¤åˆ°å®Œæˆå¯èƒ½éœ€è¦æ•°å¤© å•é“ç¨‹åºè®¾è®¡é™åˆ¶ï¼šCPUå’ŒIOè®¾å¤‡æ— æ³•å¹¶è¡Œå·¥ä½œ   3ã€å¤šé“æ‰¹å¤„ç†ç³»ç»Ÿå¤šé“æ‰¹å¤„ç†ç³»ç»Ÿèƒ½åŒæ—¶è£…å¤šä¸ªä»»åŠ¡åœ¨å†…å­˜é‡Œè‡ªåŠ¨è½®æµæ‰§è¡Œï¼Œä½†ä¸­é€”ä¸èƒ½å’Œç”¨æˆ·äº¤äº’ï¼Œä»»åŠ¡åªèƒ½ä»å¤´è·‘åˆ°å°¾ã€‚  ä¼˜ç‚¹ï¼šèµ„æºåˆ©ç”¨ç‡é«˜ï¼›ç³»ç»Ÿååé‡å¤§ ç¼ºç‚¹ï¼šå¹³å‡å‘¨è½¬æ—¶é—´é•¿ï¼›æ— äº¤äº’èƒ½åŠ›  4ã€åˆ†æ—¶æ“ä½œç³»ç»Ÿï¼ˆäº¤äº’å¼ç³»ç»Ÿï¼‰åˆ†æ—¶æ“ä½œç³»ç»ŸæŠŠ CPU...</div></div></div></a><a class="pagination-related" href="/2025/05/08/OS_Lab4/" title="OS-Lab4"><img class="cover" src="/img/top-default.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-08</div><div class="info-item-2">OS-Lab4</div></div><div class="info-2"><div class="info-item-1">#OS-Lab4 OS_Lab4æ„Ÿè§‰lab4å’Œlab3éƒ½æ¯”lab2å¥½ä¸€äº›ï¼Œç¬¨äººä»¥ä¸ºäº”ä¸€ç©è„±äº†ä¹‹åæ ¹æœ¬æ¥ä¸åŠå­¦äº†ï¼Œï¼Œï¼Œæ²¡æƒ³åˆ°çœ‹ç€ç«Ÿç„¶è¿˜è¡Œã€‚ã€‚ã€‚å¯èƒ½è¿™å°±æ˜¯å—lab2å’Œlab3æ‘§æ®‹ä¹‹åçš„ç»“æœå§ï¼Œè¿™ç¯‡æ–‡ç« è®°å½•ä¸€ä¸‹å­¦ä¹ lab4çš„å¿ƒè·¯å†ç¨‹ã€‚å…¶å®æ›´é‡è¦çš„æ˜¯æƒ³è‡ªå·±å†™ä¸€éåŠ æ·±ä¸€ä¸‹å°è±¡ï¼ ä»å®éªŒç›®çš„å¼€å§‹ï¼š  æŒæ¡ç³»ç»Ÿè°ƒç”¨çš„æ¦‚å¿µåŠæµç¨‹ å®ç°è¿›ç¨‹é—´é€šä¿¡æœºåˆ¶ å®ç° fork å‡½æ•° æŒæ¡é¡µå†™å…¥å¼‚å¸¸çš„å¤„ç†æµç¨‹  1.ç³»ç»Ÿè°ƒç”¨1.1 ç”¨æˆ·æ€ä¸å†…æ ¸æ€ ç”¨æˆ·è¿›ç¨‹åœ¨ç‰¹å®šåœºæ™¯ä¸‹éœ€è¦æ‰§è¡Œåªèƒ½ç”±å†…æ ¸å®Œæˆçš„æ“ä½œï¼ˆå¦‚ç¡¬ä»¶æ“ä½œã€åŠ¨æ€åˆ†é…å†…å­˜ã€ä¸å…¶ä»–è¿›ç¨‹è¿›è¡Œé€šä¿¡ï¼‰ã€‚ç”±äºåœ¨å†…æ ¸æ€æ‰§è¡Œç”¨æˆ·ç¨‹åºçš„ä»£ç ä¸å®‰å…¨ï¼Œå› æ­¤æ“ä½œç³»ç»Ÿè®¾è®¡äº†ä¸€ç³»åˆ—å†…æ ¸ç©ºé—´ä¸­çš„å‡½æ•°ï¼Œå½“ç”¨æˆ·è¿›è¡Œéœ€è¦æ“ä½œæ—¶ï¼Œä¼šå¼•å‘ç‰¹å®šçš„å¼‚å¸¸é™·å…¥å†…æ ¸æ€ï¼Œç”±å†…æ ¸è°ƒç”¨å¯¹åº”çš„å‡½æ•°ã€‚è¿™ç§æœºåˆ¶å«åšç³»ç»Ÿè°ƒç”¨  ç”¨æˆ·è¿›ç¨‹&amp;å†…æ ¸ï¼šè¿›ç¨‹æ˜¯èµ„æºåˆ†é…ä¸è°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œæ‹¥æœ‰ç‹¬ç«‹çš„åœ°å€ç©ºé—´ã€‚å†…æ ¸è´Ÿè´£ç®¡ç†ç³»ç»Ÿèµ„æºå’Œè°ƒåº¦è¿›ç¨‹ï¼Œä½¿å¾—è¿›ç¨‹èƒ½å¤Ÿå¹¶å‘æ‰§è¡Œã€‚äºŒè€…å¹¶ä¸æ˜¯å¯¹ç«‹çš„å­˜åœ¨ï¼Œå¯è®¤ä¸ºå†…æ ¸æ—¶å­˜åœ¨äºæ‰€æœ‰åœ°å€ç©ºé—´ä¸­çš„ä¸€æ®µä»£ç ã€‚ äººè¯ç‰ˆï¼šæ¯ä¸ªè¿›ç¨‹çš„åœ°å€ç©ºé—´è¢«åˆ’åˆ†æˆä¸¤éƒ¨åˆ†ï¼šç”¨æˆ·æ€å’Œå†…æ ¸æ€ã€‚ 1.2 ç³»ç»Ÿè°ƒç”¨å®ä¾‹ ç”¨æˆ·è°ƒç”¨...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/my-avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Nice2cu</div><div class="author-info-description">ENFPå¿«ä¹ç–¯ç‹—ç»å…¸æ¬¾</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">6</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">1</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content"><p>ğŸš€ æ¬¢è¿ç™»å½•çŸ¥è¯†å¼‚æ¬¡å…ƒç©ºé—´ï¼ğŸ”®</p></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#OS-Lab5"><span class="toc-number">1.</span> <span class="toc-text">OS_Lab5</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%BF%B0"><span class="toc-number">1.0.1.</span> <span class="toc-text">1.æ–‡ä»¶ç³»ç»Ÿæ¦‚è¿°</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%9A%84%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.0.1.1.</span> <span class="toc-text">1.1æ–‡ä»¶ç³»ç»Ÿçš„è®¾è®¡ä¸å®ç°</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%A3%81%E7%9B%98%E9%A9%B1%E5%8A%A8"><span class="toc-number">1.0.2.</span> <span class="toc-text">2.ç£ç›˜é©±åŠ¨</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E5%86%85%E5%AD%98%E6%98%A0%E5%B0%84"><span class="toc-number">1.0.2.1.</span> <span class="toc-text">2.1 å†…å­˜æ˜ å°„</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E2%80%9C%E8%AE%BE%E5%A4%87%E6%98%AF%E6%80%8E%E4%B9%88%E5%92%8C-CPU-%E9%80%9A%E4%BF%A1%E7%9A%84%EF%BC%9F%E2%80%9D"><span class="toc-number">1.0.2.1.1.</span> <span class="toc-text">1. â€œè®¾å¤‡æ˜¯æ€ä¹ˆå’Œ CPU é€šä¿¡çš„ï¼Ÿâ€</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E2%80%9C%E5%A4%96%E8%AE%BE%E5%AF%84%E5%AD%98%E5%99%A8%E6%98%AF%E6%80%8E%E4%B9%88%E6%89%BE%E5%88%B0%E7%9A%84%EF%BC%9F%E2%80%9D"><span class="toc-number">1.0.2.1.2.</span> <span class="toc-text">2. â€œå¤–è®¾å¯„å­˜å™¨æ˜¯æ€ä¹ˆæ‰¾åˆ°çš„ï¼Ÿâ€</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E2%80%9CMIPS-%E6%9E%B6%E6%9E%84%E7%94%A8%E5%93%AA%E5%9D%97%E5%9C%B0%E5%9D%80%E7%A9%BA%E9%97%B4%E6%9D%A5%E8%AE%BF%E9%97%AE%E8%AE%BE%E5%A4%87%EF%BC%9F%E2%80%9D"><span class="toc-number">1.0.2.1.3.</span> <span class="toc-text">3. â€œMIPS æ¶æ„ç”¨å“ªå—åœ°å€ç©ºé—´æ¥è®¿é—®è®¾å¤‡ï¼Ÿâ€</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-IDE%E7%A3%81%E7%9B%98"><span class="toc-number">1.0.2.2.</span> <span class="toc-text">2.2 IDEç£ç›˜</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-%E9%A9%B1%E5%8A%A8%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99"><span class="toc-number">1.0.2.3.</span> <span class="toc-text">2.3 é©±åŠ¨ç¨‹åºç¼–å†™</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84"><span class="toc-number">1.0.3.</span> <span class="toc-text">3.æ–‡ä»¶ç³»ç»Ÿç»“æ„</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1%E7%A3%81%E7%9B%98%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%B8%83%E5%B1%80"><span class="toc-number">1.0.3.1.</span> <span class="toc-text">3.1ç£ç›˜æ–‡ä»¶ç³»ç»Ÿå¸ƒå±€</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E8%AF%A6%E7%BB%86%E7%BB%93%E6%9E%84"><span class="toc-number">1.0.3.2.</span> <span class="toc-text">3.2 æ–‡ä»¶ç³»ç»Ÿè¯¦ç»†ç»“æ„</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%F0%9F%A7%B1-%E4%B8%80%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AF%E6%96%87%E4%BB%B6%E6%8E%A7%E5%88%B6%E5%9D%97%EF%BC%88struct-File%EF%BC%89%EF%BC%9F"><span class="toc-number">1.0.3.2.1.</span> <span class="toc-text">ğŸ§± ä¸€ã€ä»€ä¹ˆæ˜¯æ–‡ä»¶æ§åˆ¶å—ï¼ˆstruct Fileï¼‰ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E5%9D%97%E7%BC%93%E5%AD%98"><span class="toc-number">1.0.3.3.</span> <span class="toc-text">3.3 å—ç¼“å­˜</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%9A%84%E7%94%A8%E6%88%B7%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.0.4.</span> <span class="toc-text">4 æ–‡ä»¶ç³»ç»Ÿçš„ç”¨æˆ·æ¥å£</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6"><span class="toc-number">1.0.4.1.</span> <span class="toc-text">4.1 æ–‡ä»¶æè¿°ç¬¦</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%F0%9F%92%A11-%E4%BB%80%E4%B9%88%E6%98%AF%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6%EF%BC%88fd%EF%BC%89%EF%BC%9F"><span class="toc-number">1.0.4.1.1.</span> <span class="toc-text">ğŸ’¡1. ä»€ä¹ˆæ˜¯æ–‡ä»¶æè¿°ç¬¦ï¼ˆfdï¼‰ï¼Ÿ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%F0%9F%A7%A02-%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6%E5%86%85%E9%83%A8%E5%85%B6%E5%AE%9E%E5%AD%98%E4%BA%86%E5%BE%88%E5%A4%9A%E4%BF%A1%E6%81%AF"><span class="toc-number">1.0.4.1.2.</span> <span class="toc-text">ğŸ§ 2. æ–‡ä»¶æè¿°ç¬¦å†…éƒ¨å…¶å®å­˜äº†å¾ˆå¤šä¿¡æ¯</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%F0%9F%93%A63-Filefd-%E6%98%AF-Fd-%E7%9A%84%E2%80%9C%E5%8D%87%E7%BA%A7%E7%89%88%E2%80%9D"><span class="toc-number">1.0.4.1.3.</span> <span class="toc-text">ğŸ“¦3. Filefd æ˜¯ Fd çš„â€œå‡çº§ç‰ˆâ€</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.0.4.2.</span> <span class="toc-text">4.2 æ–‡ä»¶ç³»ç»ŸæœåŠ¡</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%F0%9F%92%A1-%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86%EF%BC%9A%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%94%AF%E6%8C%81%E7%9A%84%E6%93%8D%E4%BD%9C%E7%B1%BB%E5%9E%8B%E5%AE%9A%E4%B9%89"><span class="toc-number">1.0.4.2.1.</span> <span class="toc-text">ğŸ’¡ ç¬¬ä¸€éƒ¨åˆ†ï¼šæ–‡ä»¶ç³»ç»Ÿæ”¯æŒçš„æ“ä½œç±»å‹å®šä¹‰</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%F0%9F%92%AC-%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%EF%BC%9A%E7%94%A8%E6%88%B7%E6%80%8E%E4%B9%88%E8%AF%B7%E6%B1%82%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%EF%BC%9F"><span class="toc-number">1.0.4.2.2.</span> <span class="toc-text">ğŸ’¬ ç¬¬äºŒéƒ¨åˆ†ï¼šç”¨æˆ·æ€ä¹ˆè¯·æ±‚æ–‡ä»¶æ“ä½œï¼Ÿ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%F0%9F%A7%A0-%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86%EF%BC%9Afs-serv-%E6%80%8E%E4%B9%88%E5%A4%84%E7%90%86%E8%BF%99%E4%BA%9B%E8%AF%B7%E6%B1%82%EF%BC%9F"><span class="toc-number">1.0.4.2.3.</span> <span class="toc-text">ğŸ§  ç¬¬ä¸‰éƒ¨åˆ†ï¼šfs_serv æ€ä¹ˆå¤„ç†è¿™äº›è¯·æ±‚ï¼Ÿ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%F0%9F%A7%A0-%E6%80%BB%E7%BB%93%E4%B8%80%E5%8F%A5%E8%AF%9D"><span class="toc-number">1.0.4.2.4.</span> <span class="toc-text">ğŸ§  æ€»ç»“ä¸€å¥è¯</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%A7%B1-Lab5-%E6%B6%89%E5%8F%8A%E7%9A%84%E5%9B%9B%E4%B8%AA%E5%85%B3%E9%94%AE%E5%B1%82%E7%BA%A7%EF%BC%88%E4%BB%8E%E9%AB%98%E5%88%B0%E4%BD%8E%EF%BC%89%EF%BC%9A"><span class="toc-number">1.0.5.</span> <span class="toc-text">ğŸ§± Lab5 æ¶‰åŠçš„å››ä¸ªå…³é”®å±‚çº§ï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/05/29/OS-Theory-Chapter1/" title="OS-Theory-Chapter1"><img src="/img/top-default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="OS-Theory-Chapter1"/></a><div class="content"><a class="title" href="/2025/05/29/OS-Theory-Chapter1/" title="OS-Theory-Chapter1">OS-Theory-Chapter1</a><time datetime="2025-05-29T08:23:29.000Z" title="Created 2025-05-29 16:23:29">2025-05-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/05/27/OS_Lab5/" title="OS-Lab5"><img src="/img/top-default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="OS-Lab5"/></a><div class="content"><a class="title" href="/2025/05/27/OS_Lab5/" title="OS-Lab5">OS-Lab5</a><time datetime="2025-05-27T15:01:31.000Z" title="Created 2025-05-27 23:01:31">2025-05-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/05/08/OS_Lab4/" title="OS-Lab4"><img src="/img/top-default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="OS-Lab4"/></a><div class="content"><a class="title" href="/2025/05/08/OS_Lab4/" title="OS-Lab4">OS-Lab4</a><time datetime="2025-05-08T02:29:00.000Z" title="Created 2025-05-08 10:29:00">2025-05-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/22/OS-Lab3/" title="OS-Lab3"><img src="/img/top-default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="OS-Lab3"/></a><div class="content"><a class="title" href="/2025/04/22/OS-Lab3/" title="OS-Lab3">OS-Lab3</a><time datetime="2025-04-22T12:14:31.000Z" title="Created 2025-04-22 20:14:31">2025-04-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/13/%E4%BB%A3%E7%A0%81%E5%9D%97%E6%BC%94%E7%A4%BA/" title="ä»£ç æ¼”ç¤º"><img src="/img/top-banner.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ä»£ç æ¼”ç¤º"/></a><div class="content"><a class="title" href="/2025/04/13/%E4%BB%A3%E7%A0%81%E5%9D%97%E6%BC%94%E7%A4%BA/" title="ä»£ç æ¼”ç¤º">ä»£ç æ¼”ç¤º</a><time datetime="2025-04-13T06:34:00.000Z" title="Created 2025-04-13 14:34:00">2025-04-13</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;2025 By Nice2cu</span><span class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.4.0-b1</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>